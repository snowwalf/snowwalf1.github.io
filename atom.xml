<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æµ®ç”ŸåŠæ—¥é—²</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.snowwalf.com/"/>
  <updated>2017-02-20T14:11:56.000Z</updated>
  <id>http://blog.snowwalf.com/</id>
  
  <author>
    <name>snowwalf</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>å¥æŸ„æ³„éœ²å›´æ•è®°</title>
    <link href="http://blog.snowwalf.com/2017/02/18/%E5%8F%A5%E6%9F%84%E6%B3%84%E9%9C%B2%E5%9B%B4%E6%8D%95%E8%AE%B0/"/>
    <id>http://blog.snowwalf.com/2017/02/18/å¥æŸ„æ³„éœ²å›´æ•è®°/</id>
    <published>2017-02-18T04:13:44.000Z</published>
    <updated>2017-02-20T14:11:56.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>è®°å½•å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„BUGåŠè§£å†³é—®é¢˜çš„ä¸€äº›ç»éªŒ</em><br><a id="more"></a></p>
<h1 id="é—®é¢˜å‘ç°"><a href="#é—®é¢˜å‘ç°" class="headerlink" title="é—®é¢˜å‘ç°"></a>é—®é¢˜å‘ç°</h1><p>åšä¸»è´Ÿè´£çš„ä¸€ä¸ªåœ¨çº¿å›¾ç‰‡å¤„ç†æœåŠ¡ï¼Œå­˜åœ¨é•¿æ—¶é—´ï¼ˆè¶…è¿‡20å¤©ï¼‰è¿è¡Œåä¼šæœåŠ¡è¿›ç¨‹å‡ºé”™é€€å‡ºçš„é—®é¢˜ã€‚è¿ç»´å°ä¼™ä¼´æŠŠæƒ…å†µæŠ¥åˆ°å¼€å‘è¿™ï¼Œå¹¶æ²¡æœ‰æ›´å¤šçš„ä¿¡æ¯ğŸ˜µğŸ˜µğŸ˜µ</p>
<h1 id="åˆæ­¥åˆ†æ"><a href="#åˆæ­¥åˆ†æ" class="headerlink" title="åˆæ­¥åˆ†æ"></a>åˆæ­¥åˆ†æ</h1><h2 id="äº§å“æœåŠ¡"><a href="#äº§å“æœåŠ¡" class="headerlink" title="äº§å“æœåŠ¡"></a>äº§å“æœåŠ¡</h2><p>è¯¥äº§å“æ˜¯ä¸€ä¸ªäº‘è®¡ç®—å›¾ç‰‡å¤„ç†æœåŠ¡ï¼ˆå‚è§ä¸ƒç‰›æ•°æ®å¤„ç†æœåŠ¡ï¼‰ï¼Œåå°ä½¿ç”¨åˆ°äº†imageMagick SDKçš„åŸºæœ¬å›¾ç‰‡å¤„ç†åŠŸèƒ½ã€‚</p>
<p>æœåŠ¡åŒæ—¶éƒ¨ç½²åœ¨ç‰©ç†æœåŠ¡å™¨å’Œå®¹å™¨ä¸­ï¼Œå¤šä¸ªå¼‚åœ°åŒºåŸŸæœºæˆ¿ï¼Œä½†å®é™…ä»…åœ¨å…¶ä¸­ä¸€ä¸ªæœºæˆ¿çš„ç‰©ç†é›†ç¾¤ä¸­å‘ç”Ÿè¿›ç¨‹é‡å¯çš„æƒ…å†µï¼ˆæœåŠ¡ä½¿ç”¨supervisorctlæ‰˜ç®¡ï¼Œå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯ï¼‰ã€‚</p>
<p>çº¿ä¸ŠæœåŠ¡å¹¶æœªå¼€å¯coredumpï¼›å‡ºcoreæ—¥å¿—è°ƒç”¨æ ˆä»…æ˜¾ç¤ºæ•è·signal 11ï¼Œå›æ”¾ä¸Šä¸€æ¡çš„æœåŠ¡è¯·æ±‚å¹¶ä¸èƒ½è§¦å‘é”™è¯¯ã€‚</p>
<p>æŸ¥çœ‹è¯¥æœåŠ¡åœ¨æ­¤DCä¸­ç›‘æ§æƒ…å†µï¼Œå‘ç°å³°å€¼TPSåœ¨40K+ï¼Œæ—¥å‡TPSçº¦åœ¨20Kå·¦å³ï¼ŒCPUã€å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œå¸¦å®½å‡åœ¨è­¦æˆ’å€¼ä»¥ä¸‹ï¼ŒæœåŠ¡å™¨å¥æŸ„æ•°ä¿æŒåœ¨æœ€é«˜ç»´æŒåœ¨10Kå·¦å³ã€‚</p>
<h2 id="è¯Šæ–­"><a href="#è¯Šæ–­" class="headerlink" title="è¯Šæ–­"></a>è¯Šæ–­</h2><p>æ ¹æ®ç»éªŒï¼Œé•¿æ—¶é—´è¿è¡ŒåæœåŠ¡è¿›ç¨‹å‡ºé”™é€€å‡ºï¼Œå¾€å¾€æ˜¯å› ä¸ºå­˜åœ¨èµ„æºæ³„éœ²ï¼Œä¾‹å¦‚å†…å­˜æ³„éœ²ã€å¥æŸ„æ³„éœ²ã€ä¸´æ—¶æ–‡ä»¶æœªåˆ é™¤ç­‰ã€‚</p>
<p>è°ƒå–æœåŠ¡è¿›ç¨‹çš„ç‰©ç†èµ„æºä½¿ç”¨æƒ…å†µè¿›è¡Œåˆ†æï¼ŒCPUã€å†…å­˜å‡æ— æ˜¾è‘—å¼‚å¸¸ï¼Œä½†æ–‡ä»¶å¥æŸ„ä½¿ç”¨æƒ…å†µå­˜åœ¨é—®é¢˜</p>
<img src="http://ohgqsah1g.bkt.clouddn.com/20170218/fd-leak.png" class="fd-process" title="æœåŠ¡å¥æŸ„é‡">
<p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡å¥æŸ„æ•°åŸºæœ¬å‘ˆçº¿æ€§å¢é•¿ï¼Œé™¡é™çš„åœ°æ–¹ä¸ºæœåŠ¡è¿›ç¨‹è¢«é‡å¯äº†ï¼ˆæ¯”å¦‚æœåŠ¡æ›´æ–°å‘å¸ƒï¼‰ï¼Œè¿™å¯¹äºä¸€ä¸ªé•¿æœŸè¿è¡Œçš„æœåŠ¡ç«¯ç¨‹åºæ˜¯ä¸åˆç†çš„ã€‚</p>
<p>æ•…èƒ½åˆæ­¥åˆ¤æ–­å‡ºï¼Œç¨‹åºå­˜åœ¨æ–‡ä»¶å¥æŸ„æ³„éœ²ã€‚</p>
<h1 id="æ·±å…¥åˆ†æ"><a href="#æ·±å…¥åˆ†æ" class="headerlink" title="æ·±å…¥åˆ†æ"></a>æ·±å…¥åˆ†æ</h1><h2 id="çº¿ä¸Šåˆ†æ"><a href="#çº¿ä¸Šåˆ†æ" class="headerlink" title="çº¿ä¸Šåˆ†æ"></a>çº¿ä¸Šåˆ†æ</h2><p>è¯¥æœåŠ¡éƒ¨ç½²åœ¨å¤šä¸ªDCï¼ŒæœåŠ¡å‘ç”Ÿè¿›ç¨‹é‡å¯å‡é›†ä¸­åœ¨ä¸€ä¸ªDCã€‚è¯¥DCæœåŠ¡è¯·æ±‚æœ€é«˜ï¼Œå³°å€¼TPSå¯ä»¥è¾¾åˆ°30+Kï¼›ç›¸å¯¹å…¶ä»–DCçš„è¯·æ±‚é‡è¦å°ä¸€ä¸ªæ•°é‡çº§ã€‚</p>
<p>ç™»å½•æœåŠ¡éƒ¨ç½²åœ¨DCçš„ä¸€å°æœåŠ¡å™¨ï¼Œä½¿ç”¨lsofæŸ¥è¯¢æœåŠ¡è¿›è¡ŒFDä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥å‘ç°å­˜åœ¨å¤§é‡çš„FDå¤„äºdeletedçŠ¶æ€ï¼ˆæ ‡è®°åˆ é™¤ä½†ä»æœªé‡Šæ”¾ï¼‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">lsof -p 9291  | grep deleted</div><div class="line"></div><div class="line">...</div><div class="line">qboximage 9291 qboxserver 1228r      REG        8,1     31346    4487983 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d98ac907d245_452020_1d0 (deleted)</div><div class="line">qboximage 9291 qboxserver 1229r      REG        8,1     18542    4487917 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d9871a4080c3_44d568_364 (deleted)</div><div class="line">qboximage 9291 qboxserver 1230r      REG        8,1     37602    4488004 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d9858c894d31_44b62d_25f (deleted)</div><div class="line">qboximage 9291 qboxserver 1231r      REG        8,1     50062    4487872 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d97fe5e79906_44401e_26d (deleted)</div><div class="line">qboximage 9291 qboxserver 1232r      REG        8,1     12640    4487898 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d9894b49bfcc_45018b_2d9 (deleted)</div><div class="line">qboximage 9291 qboxserver 1233r      REG        8,1     49844    4488020 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d989f6040b2d_450f17_2bf (deleted)</div><div class="line">qboximage 9291 qboxserver 1239r      REG        8,1     10772    4487929 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d980dc71106c_4454e1_1ef (deleted)</div><div class="line">qboximage 9291 qboxserver 1240r      REG        8,1     73538    4487977 /home/qboxserver/image6/_package/run/fopd_tmpdir/mogr2_244b_34d989d52655ea_450c7e_1b5 (deleted)</div><div class="line">...</div></pre></td></tr></table></figure>
<p>è¿›ç¨‹é‡å¯åï¼Œå•æ—¥å¯å †ç§¯æœªé‡Šæ”¾çš„FDåˆ°500ä¸ªå·¦å³</p>
<h2 id="æ—¥å¿—åˆ†æ"><a href="#æ—¥å¿—åˆ†æ" class="headerlink" title="æ—¥å¿—åˆ†æ"></a>æ—¥å¿—åˆ†æ</h2><p>ç”¨lsofæŸ¥çœ‹æœªé‡Šæ”¾çš„FDï¼Œå‘ç°éƒ½æ˜¯æŒ‡å‘æœåŠ¡æµç¨‹ä¸­çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ä¸­åŒ…å«å”¯ä¸€HASHå­—ç¬¦ä¸²ã€‚</p>
<p>åœ¨æ—¥å¿—ç³»ç»Ÿä¸­æ£€ç´¢ä¸Šè¿°hashå€¼ï¼Œå‘ç°éƒ½æ˜¯åŒä¸€ç§è¯·æ±‚ç±»å‹ï¼Œå³webpå›¾ç‰‡è½¬æˆwebpè¯·æ±‚ï¼ŒçŒœæµ‹å¯èƒ½ä¸webpå¤„ç†ä¾‹ç¨‹æœ‰å…³ã€‚</p>
<p>éšæœºæŠ“å–å‡ ä¸ªè¯·æ±‚ï¼Œä»»é€‰ä¸€å°æœåŠ¡å™¨ï¼Œè¿›è¡Œè¯·æ±‚å›è®¿ï¼Œç»“åˆæ—¥å¿—ç³»ç»Ÿä½¿ç”¨lsofæ£€ç´¢ï¼Œå‘ç°ç¡®å®æ¯ä¸€ä¸ªwebpè½¬webpçš„è¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªFDæ³„éœ²ã€‚æ„é€ ç±»ä¼¼çš„è¯·æ±‚ï¼Œå‘é€çº¿ä¸Šå…¶ä»–DCè¿›è¡Œå¤„ç†ï¼Œé€šè¿‡åå°æ—¥å¿—+lsofï¼Œå‘ç°åŒæ ·ä¹Ÿå‘ç”Ÿäº†FDæ³„éœ²ã€‚</p>
<p>æŠ“å–çº¿ä¸Šæ–‡ä»¶ï¼Œå°†çº¿ä¸ŠæœåŠ¡è¯·æ±‚åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒè¿›è¡Œå›æ”¾ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥äº§ç”Ÿå¥æŸ„æ³„éœ²ã€‚</p>
<p>è‡³æ­¤ï¼ŒBUGå¯ä»¥ç¨³å®šå¤ç°ï¼Œå¯ä»¥ç¡®å®šé’ˆå¯¹webpè½¬webpçš„è¯·æ±‚å­˜åœ¨å¥æŸ„æ³„éœ²ã€‚</p>
<h1 id="è°ƒè¯•åˆ†æ"><a href="#è°ƒè¯•åˆ†æ" class="headerlink" title="è°ƒè¯•åˆ†æ"></a>è°ƒè¯•åˆ†æ</h1><h2 id="æ³„éœ²å®šä½"><a href="#æ³„éœ²å®šä½" class="headerlink" title="æ³„éœ²å®šä½"></a>æ³„éœ²å®šä½</h2><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ³„éœ²å‘ç”Ÿåœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿè¯¥æœåŠ¡ç«¯http serverä½¿ç”¨goè¯­è¨€ï¼Œå›¾ç‰‡å¤„ç†ä½¿ç”¨cgoè°ƒç”¨å¼€æºåº“imageMagickçš„SDKï¼ŒæœåŠ¡ä»£ç å°±æœ‰ä¸Šåƒè¡Œï¼Œå¼€æºåº“éƒ¨åˆ†åšä¸»è¿˜ä¸å¤Ÿç†Ÿæ‚‰ğŸ˜³ğŸ˜³ğŸ˜³</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œç”Ÿå•ƒä»£ç å»æ‰¾BUGç»å¯¹ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œéœ€è¦å¦æƒ³åŠæ³•ã€‚</p>
<p>ç®€å•æµè§ˆimageMagickçš„ä»£ç ï¼Œå¯ä»¥å‘ç°å¤§éƒ¨åˆ†éƒ½æ˜¯Cè¯­è¨€å†™çš„ï¼ˆMagick++éƒ¨åˆ†è¿›è¡Œäº†é¢å‘å¯¹è±¡çš„å°è£…ï¼Œä½¿ç”¨äº†C++ï¼‰ã€‚æ„Ÿè°¢ç”·ç¥è°­æµ©å¼ºï¼Œåšä¸»è¿˜è®°å¾—ï¼ŒCè¯­è¨€ä¸­æ¶‰åŠæ–‡ä»¶å¥æŸ„çš„å‡½æ•°ä¸»è¦æœ‰openã€closeã€fopenå’Œfcloseï¼Œä¹Ÿæ˜¯æƒ³åˆ°äº†å¯ä»¥é€šè¿‡Hackåº•å±‚libcçš„åº“å‡½æ•°ã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œä¸Šä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;string.h&gt;</div><div class="line">#include &lt;dlfcn.h&gt;</div><div class="line">#include &lt;execinfo.h&gt;</div><div class="line"></div><div class="line">typedef int(*OPEN) (const char * pathname, int flags);</div><div class="line">typedef int(*CLOSE) (int fildes);</div><div class="line">typedef FILE*(*FOPEN) (const char * path, const char * mode);</div><div class="line">typedef int(*FCLOSE)(FILE* stream);</div><div class="line"></div><div class="line"></div><div class="line">/* æ‰“å°è°ƒç”¨æ ˆçš„æœ€å¤§æ·±åº¦ */</div><div class="line">#define DUMP_STACK_DEPTH_MAX 16</div><div class="line">void dump_trace() &#123;</div><div class="line">    void *stack_trace[DUMP_STACK_DEPTH_MAX] = &#123;0&#125;;</div><div class="line">    char **stack_strings = NULL;</div><div class="line">    int stack_depth = 0;</div><div class="line">    int i = 0;</div><div class="line"></div><div class="line">    /* è·å–æ ˆä¸­å„å±‚è°ƒç”¨å‡½æ•°åœ°å€ */</div><div class="line">    stack_depth = backtrace(stack_trace, DUMP_STACK_DEPTH_MAX);</div><div class="line"></div><div class="line">    /* æŸ¥æ‰¾ç¬¦å·è¡¨å°†å‡½æ•°è°ƒç”¨åœ°å€è½¬æ¢ä¸ºå‡½æ•°åç§° */</div><div class="line">    stack_strings = (char **)backtrace_symbols(stack_trace, stack_depth);</div><div class="line">    if (NULL == stack_strings) &#123;</div><div class="line">        printf(&quot; Memory is not enough while dump Stack Trace! \r\n&quot;);</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /* æ‰“å°è°ƒç”¨æ ˆ */</div><div class="line">    printf(&quot; Stack Trace: \r\n&quot;);</div><div class="line">    for (i = 0; i &lt; stack_depth; ++i) &#123;</div><div class="line">        printf(&quot; [%d] %s \r\n&quot;, i, stack_strings[i]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /* è·å–å‡½æ•°åç§°æ—¶ç”³è¯·çš„å†…å­˜éœ€è¦è‡ªè¡Œé‡Šæ”¾ */</div><div class="line">    free(stack_strings);</div><div class="line">    stack_strings = NULL;</div><div class="line"></div><div class="line">    return;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int open(const char * pathname, int flags)</div><div class="line">&#123;</div><div class="line">    static void *handle = NULL;</div><div class="line">    static OPEN old_open = NULL;</div><div class="line">    if( !handle )</div><div class="line">    &#123;</div><div class="line">        handle = dlopen(&quot;libc.so.6&quot;, RTLD_LAZY);</div><div class="line">        old_open = (OPEN)dlsym(handle, &quot;open&quot;);</div><div class="line">    &#125;</div><div class="line">    int fd = old_open(pathname, flags); </div><div class="line">    printf(&quot;open function invoked. path=[%s] flag=&lt;%d&gt; fd=[%d]\n&quot;, pathname, flags, fd);</div><div class="line">    dump_trace();</div><div class="line">    return fd;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int close(int fildes)</div><div class="line">&#123;</div><div class="line">    static void *handle = NULL;</div><div class="line">    static CLOSE old_close = NULL;</div><div class="line">    if( !handle )</div><div class="line">    &#123;</div><div class="line">        handle = dlopen(&quot;libc.so.6&quot;, RTLD_LAZY);</div><div class="line">        old_close = (CLOSE)dlsym(handle, &quot;open&quot;);</div><div class="line">    &#125;</div><div class="line">    printf(&quot;close function invoked. fd=[%d] flag=&lt;%d&gt;\n&quot;, fildes);</div><div class="line">    dump_trace();</div><div class="line">    return old_close(fildes);</div><div class="line">&#125;</div><div class="line"></div><div class="line">FILE* fopen(const char * path, const char * mode)</div><div class="line">&#123;</div><div class="line">    static void *handle = NULL;</div><div class="line">    static FOPEN old_fopen = NULL;</div><div class="line">    if( !handle )</div><div class="line">    &#123;</div><div class="line">        handle = dlopen(&quot;libc.so.6&quot;, RTLD_LAZY);</div><div class="line">        old_fopen = (FOPEN)dlsym(handle, &quot;fopen&quot;);</div><div class="line">    &#125;</div><div class="line">    FILE* f =  old_fopen(path,mode);</div><div class="line">    printf(&quot;fopen function invoked. path=[%s] flag=&lt;%s&gt; FILE=[%p]\n&quot;, path, mode,f);</div><div class="line">    dump_trace();</div><div class="line">    return f;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int fclose(FILE* stream)</div><div class="line">&#123;</div><div class="line">    static void *handle = NULL;</div><div class="line">    static FCLOSE old_fclose = NULL;</div><div class="line">    if( !handle )</div><div class="line">    &#123;</div><div class="line">        handle = dlopen(&quot;libc.so.6&quot;, RTLD_LAZY);</div><div class="line">        old_fclose = (FCLOSE)dlsym(handle, &quot;fclose&quot;);</div><div class="line">    &#125;</div><div class="line">    printf(&quot;fclose function invoked. FILE=[%p]\n&quot;, stream);</div><div class="line">    dump_trace();</div><div class="line">    return old_fclose(stream);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°ä»£ç å‹¾äº†libcä¸­çš„openã€closeã€fopenå’Œfcloseå‡½æ•°ï¼Œæ‰“å°å‡ºäº†è°ƒç”¨å‚æ•°ï¼Œä»¥åŠå‡½æ•°è°ƒç”¨å †æ ˆ</p>
<p>ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gcc -fPIC -shared -o hook.so hook.c -ldl</div></pre></td></tr></table></figure></p>
<p>æ‰‹åŠ¨æŒ‚è½½åŠ¨æ€é“¾æ¥åº“ï¼Œæœ¬åœ°å¯åŠ¨æœåŠ¡ç¨‹åº<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LD_LIBRARY_PATH=./hook.so ./qboximage -f ./qboximage.conf</div></pre></td></tr></table></figure></p>
<p>é‡æ–°å‘é€ä¹‹å‰çš„è¯·æ±‚ï¼Œå¯ä»¥ä»æ—¥å¿—ä¸­è·å–å¯¹åº”FDçš„æƒ…å†µå¦‚ä¸‹ï¼š<br>ç¬¬ä¸€æ¬¡å¥æŸ„æ‰“å¼€(fopen)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">fopen function invoked. path=[/workspace/tmp/mogr2_7_34d6663757bf64_1_31a] flag=&lt;rb&gt; FILE=[0x7fe4b403a5b0]</div><div class="line"> Stack Trace: </div><div class="line"></div><div class="line"> [0] /root/hook.so(dump_trace+0x52) [0x7fe4c8e609a7] </div><div class="line"></div><div class="line"> [1] /root/hook.so(fopen+0x96) [0x7fe4c8e60c07] </div><div class="line"></div><div class="line"> [2] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(OpenBlob+0x6eb) [0x7fe4c85112eb] </div><div class="line"></div><div class="line"> [3] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(SetImageInfo+0x262) [0x7fe4c85d8332] </div><div class="line"></div><div class="line"> [4] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(ReadImage+0xa1) [0x7fe4c85454a1] </div><div class="line"></div><div class="line"> [5] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(ReadImages+0x15b) [0x7fe4c85465db] </div><div class="line"></div><div class="line"> [6] /root/fop_depend/_package/lib_for_fopd/libMagickWand-6.Q16.so.2(ConvertImageCommand+0x993) [0x7fe4c8b83d53] </div><div class="line"></div><div class="line"> [7] /root/fop_depend/_package/lib_for_fopd/libMagickWand-6.Q16.so.2(MagickCommandGenesis+0x6b3) [0x7fe4c8bf0b63] </div><div class="line"></div><div class="line"> [8] /root/dora-image(_cgo_f771dc2ebe72_Cfunc_myConvert+0x4b) [0x86cd5b] </div><div class="line"></div><div class="line"> [9] /root/dora-image() [0x475770]</div></pre></td></tr></table></figure></p>
<p>å¯¹åº”çš„å¥æŸ„å…³é—­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">fclose function invoked. FILE=[0x7fe4b403a5b0]</div><div class="line"> Stack Trace: </div><div class="line"></div><div class="line"> [0] /root/hook.so(dump_trace+0x52) [0x7fe4c8e609a7] </div><div class="line"></div><div class="line"> [1] /root/hook.so(fclose+0x6f) [0x7fe4c8e60c7c] </div><div class="line"></div><div class="line"> [2] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(CloseBlob+0x241) [0x7fe4c8510b21] </div><div class="line"></div><div class="line"> [3] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(SetImageInfo+0x343) [0x7fe4c85d8413] </div><div class="line"></div><div class="line"> [4] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(ReadImage+0xa1) [0x7fe4c85454a1] </div><div class="line"></div><div class="line"> [5] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(ReadImages+0x15b) [0x7fe4c85465db] </div><div class="line"></div><div class="line"> [6] /root/fop_depend/_package/lib_for_fopd/libMagickWand-6.Q16.so.2(ConvertImageCommand+0x993) [0x7fe4c8b83d53] </div><div class="line"></div><div class="line"> [7] /root/fop_depend/_package/lib_for_fopd/libMagickWand-6.Q16.so.2(MagickCommandGenesis+0x6b3) [0x7fe4c8bf0b63] </div><div class="line"></div><div class="line"> [8] /root/dora-image(_cgo_f771dc2ebe72_Cfunc_myConvert+0x4b) [0x86cd5b] </div><div class="line"></div><div class="line"> [9] /root/dora-image() [0x475770]</div></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒæ¬¡å¥æŸ„æ‰“å¼€ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">fopen function invoked. path=[/workspace/tmp/mogr2_7_34d6663757bf64_1_31a] flag=&lt;rb&gt; FILE=[0x7fe4b403de50]</div><div class="line"> Stack Trace: </div><div class="line"></div><div class="line"> [0] /root/hook.so(dump_trace+0x52) [0x7fe4c8e609a7] </div><div class="line"></div><div class="line"> [1] /root/hook.so(fopen+0x96) [0x7fe4c8e60c07] </div><div class="line"></div><div class="line"> [2] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(OpenBlob+0x6eb) [0x7fe4c85112eb] </div><div class="line"></div><div class="line"> [3] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(+0x30aada) [0x7fe4c8791ada] </div><div class="line"></div><div class="line"> [4] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(ReadImage+0x198) [0x7fe4c8545598] </div><div class="line"></div><div class="line"> [5] /root/fop_depend/_package/lib_for_fopd/libMagickCore-6.Q16.so.2(ReadImages+0x15b) [0x7fe4c85465db] </div><div class="line"></div><div class="line"> [6] /root/fop_depend/_package/lib_for_fopd/libMagickWand-6.Q16.so.2(ConvertImageCommand+0x993) [0x7fe4c8b83d53] </div><div class="line"></div><div class="line"> [7] /root/fop_depend/_package/lib_for_fopd/libMagickWand-6.Q16.so.2(MagickCommandGenesis+0x6b3) [0x7fe4c8bf0b63] </div><div class="line"></div><div class="line"> [8] /root/dora-image(_cgo_f771dc2ebe72_Cfunc_myConvert+0x4b) [0x86cd5b] </div><div class="line"></div><div class="line"> [9] /root/dora-image() [0x475770]</div></pre></td></tr></table></figure></p>
<p>ç„¶åå°±ä¹ˆæœ‰å…³é—­äº†ã€‚ã€‚ã€‚å¥½å§ï¼Œè‡³æ­¤ç¡®å®šäº†FDåœ¨è¿™é‡Œè½è·‘äº†</p>
<h2 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h2><p>é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œæ ¹æ®è°ƒç”¨å †æ ˆï¼Œå¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬¡è°ƒç”¨fopençš„æ˜¯OpenBlobå‡½æ•°ã€‚grepäº†ä¸€æŠŠimageMagickçš„ä»£ç ï¼Œå‘ç°æœ‰å¥½å‡ åå¤„ã€‚ã€‚ã€‚åšä¸»æœ€æ¨è¿™ç§å¤§æµ·æé’ˆçš„çœ‹ä»£ç ğŸ˜ ï¼Œä¸€å®šè¦å†æƒ³æƒ³åŠæ³•</p>
<p>æ—¢ç„¶æœ‰äº†è°ƒç”¨å †æ ˆï¼Œä¹Ÿå°±æœ‰äº†å‡½æ•°èµ·å§‹åœ°å€å’Œè°ƒç”¨åç§»åœ°å€ï¼Œä¸ºå•¥ä¸åæ±‡ç¼–ä¸‹ä»£ç ï¼Œå‡è½»çœ‹ä»£ç çš„å·¥ä½œé‡å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œçœ‹è°ƒç”¨å †æ ˆï¼Œå‘ç°æ‰€æœ‰imageMagickè°ƒç”¨éƒ½åœ¨åŠ¨æ€é“¾æ¥åº“libMagickCore-6.Q16.so.2ä¸­ã€‚éœ€è¦downä¸€ä»½çº¿ä¸ŠåŒç‰ˆæœ¬çš„imageMagickä»£ç ï¼ˆv6.9.2ï¼Œå®æµ‹æœ€æ–°ä»£ç ä¹Ÿè¦åŒæ ·é—®é¢˜ï¼‰ï¼Œæ‰“å¼€-gç¼–è¯‘é€‰é¡¹ï¼Œæ›¿æ¢æ‰å¼€å‘ç¯å¢ƒåŸæœ‰çš„libMagickCore-6.Q16.so.2åº“ï¼Œé‡å¤ä¹‹å‰çš„è°ƒè¯•æ­¥éª¤ï¼Œè·å¾—æ–°çš„è°ƒç”¨å †æ ˆã€‚åšä¸»æœ¬åœ°å¸¸å¹´ç”¨çš„è°ƒè¯•ç‰ˆsoï¼Œæ•…çœç•¥è¯¥æ­¥ã€‚ã€‚ã€‚</p>
<p>ç„¶åï¼Œä½¿ç”¨objdumpåæ±‡ç¼–è¯¥åŠ¨æ€é“¾æ¥åº“ï¼Œæ¯”è¾ƒå¤§ï¼Œéœ€è¦è€å¿ƒç­‰å¾…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">objdump -l -DS ./libMagickCore-6.Q16.so.2 &gt; image.dump</div></pre></td></tr></table></figure></p>
<p>æŸ¥æ‰¾ç¬¬äºŒæ¬¡OpenBlobçš„è°ƒç”¨åœ°å€ï¼Œ.textæ®µï¼Œåç§»åœ°å€+0x30aada<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">/root/ImageMagick-6.9.1-2/coders/webp.c:250</div><div class="line">  30aada:       85 c0                   test   %eax,%eax</div><div class="line">  30aadc:       0f 84 92 00 00 00       je     30ab74 &lt;ReadWEBPImage+0x124&gt;</div><div class="line">WebPInitDecoderConfig():</div><div class="line">/usr/local/include/webp/decode.h:466</div><div class="line">  30aae2:       4c 8d 6c 24 40          lea    0x40(%rsp),%r13</div><div class="line">  30aae7:       be 03 02 00 00          mov    $0x203,%esi</div><div class="line">  30aaec:       4c 89 ef                mov    %r13,%rdi</div><div class="line">  30aaef:       e8 0c 1a d6 ff          callq  6c500 &lt;WebPInitDecoderConfigInternal@plt&gt;</div></pre></td></tr></table></figure></p>
<p>æŠ“åˆ°äº†ï¼Œé—®é¢˜å‡ºåœ¨coders/webp.cï¼Œç¬¬250è¡Œã€‚ã€‚ã€‚</p>
<h1 id="BUGè§£å†³"><a href="#BUGè§£å†³" class="headerlink" title="BUGè§£å†³"></a>BUGè§£å†³</h1><p>å®šä½åˆ°äº†å‡ºé”™ä»£ç ä½ç½®å°±å¥½åŠäº†ã€‚ç»è¿‡å¯¹ä»£ç çš„åˆ†æï¼Œä¸éš¾çœ‹å‡ºï¼ŒimageMagickåœ¨webpçš„è§£åŒ…å™¨ä¸­ä½¿ç”¨OpenBlobæ‰“å¼€äº†æºæ–‡ä»¶ï¼Œè¿”å›å‰å¿˜è®°å…³é—­äº†ã€‚ã€‚ã€‚</p>
<p>psï¼šåšä¸»å‘æ–‡å‰ï¼Œæäº¤çš„fix prå·²è¢«masterä»£ç åˆå¹¶ï¼Œæ•…ä¸Šè¿°é—®é¢˜å®˜æ–¹æœ€æ–°ä»£ç å·²ä¿®å¤</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;è®°å½•å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„BUGåŠè§£å†³é—®é¢˜çš„ä¸€äº›ç»éªŒ&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ç ç»" scheme="http://blog.snowwalf.com/categories/%E7%A0%81%E7%BB%8F/"/>
    
    
      <category term="imageMagick" scheme="http://blog.snowwalf.com/tags/imageMagick/"/>
    
      <category term="æ–‡ä»¶å¥æŸ„æ³„éœ²" scheme="http://blog.snowwalf.com/tags/%E6%96%87%E4%BB%B6%E5%8F%A5%E6%9F%84%E6%B3%84%E9%9C%B2/"/>
    
  </entry>
  
  <entry>
    <title>ImageMagickå·¥å…·ä¹‹Identifyåˆ†æ</title>
    <link href="http://blog.snowwalf.com/2017/01/25/ImageMagick%E5%B7%A5%E5%85%B7%E4%B9%8BIdentify%E5%88%86%E6%9E%90/"/>
    <id>http://blog.snowwalf.com/2017/01/25/ImageMagickå·¥å…·ä¹‹Identifyåˆ†æ/</id>
    <published>2017-01-25T02:54:55.000Z</published>
    <updated>2017-01-25T03:13:48.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>æ‘˜è¦ï¼šåˆ†æImageMagickå·¥å…·ä¸­identifyçš„ä½¿ç”¨ä»¥åŠç»“æœå†…å®¹è¯´æ˜</em><br><a id="more"></a></p>
<h1 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ identify example.png</div><div class="line">-&gt; example.png PNG 750x404 750x404+0+0 8-bit sRGB 103KB 0.000u 0:00.000</div></pre></td></tr></table></figure>
<h2 id="è¾“å‡ºåˆ†æ"><a href="#è¾“å‡ºåˆ†æ" class="headerlink" title="è¾“å‡ºåˆ†æ"></a>è¾“å‡ºåˆ†æ</h2><table>
<thead>
<tr>
<th>é¡¹ç›®åç§°</th>
<th>è¯´æ˜</th>
<th>ç¤ºä¾‹é¡¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ–‡ä»¶å</td>
<td>å›¾ç‰‡æ–‡ä»¶çš„æ–‡ä»¶å</td>
<td>example.png</td>
</tr>
<tr>
<td>å›¾ç‰‡æ ¼å¼</td>
<td>å›¾ç‰‡ç¼–ç æ ¼å¼</td>
<td>PNG</td>
</tr>
<tr>
<td>åƒç´ å¤§å°</td>
<td>æè¿°å›¾ç‰‡å¤§å°ï¼Œå•ä½ä¸ºåƒç´ </td>
<td>750x404</td>
</tr>
<tr>
<td>å‡ ä½•å±æ€§ï¼ˆGeometryï¼‰</td>
<td>æè¿°äº†å›¾ç‰‡çš„å¤§å°å’Œç›¸å¯¹ä½ç½®ï¼Œæ ¼å¼<width>x<height>{+-}<xoffset>{+-}<yoffset></yoffset></xoffset></height></width></td>
<td>750x404+0+0</td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;æ‘˜è¦ï¼šåˆ†æImageMagickå·¥å…·ä¸­identifyçš„ä½¿ç”¨ä»¥åŠç»“æœå†…å®¹è¯´æ˜&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ImageMagick" scheme="http://blog.snowwalf.com/categories/ImageMagick/"/>
    
    
      <category term="å›¾ç‰‡" scheme="http://blog.snowwalf.com/tags/%E5%9B%BE%E7%89%87/"/>
    
      <category term="ImageMagick" scheme="http://blog.snowwalf.com/tags/ImageMagick/"/>
    
      <category term="identify" scheme="http://blog.snowwalf.com/tags/identify/"/>
    
  </entry>
  
  <entry>
    <title>å½©è‰²æ¨¡å‹</title>
    <link href="http://blog.snowwalf.com/2017/01/22/%E5%BD%A9%E8%89%B2%E6%A8%A1%E5%9E%8B/"/>
    <id>http://blog.snowwalf.com/2017/01/22/å½©è‰²æ¨¡å‹/</id>
    <published>2017-01-22T11:50:18.000Z</published>
    <updated>2017-01-22T11:52:05.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>æ‘˜è¦ï¼š ä»‹ç»å›¾ç‰‡å½©è‰²æ¨¡å‹çš„åŸºæœ¬çŸ¥è¯†</em><br><a id="more"></a></p>
<h1 id="æ¦‚å¿µç®€ä»‹"><a href="#æ¦‚å¿µç®€ä»‹" class="headerlink" title="æ¦‚å¿µç®€ä»‹"></a>æ¦‚å¿µç®€ä»‹</h1><h2 id="å½©è‰²æ¨¡å‹"><a href="#å½©è‰²æ¨¡å‹" class="headerlink" title="å½©è‰²æ¨¡å‹"></a>å½©è‰²æ¨¡å‹</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><blockquote><p>è‰²å½©æ¨¡å‹æ˜¯æè¿°ä½¿ç”¨ä¸€ç»„å€¼ï¼ˆé€šå¸¸ä½¿ç”¨ä¸‰ä¸ªã€å››ä¸ªå€¼æˆ–è€…é¢œè‰²æˆåˆ†ï¼‰è¡¨ç¤ºé¢œè‰²æ–¹æ³•çš„æŠ½è±¡æ•°å­¦æ¨¡å‹ã€‚<br>ä½†æ˜¯ä¸€ä¸ªä¸ç»å¯¹è‰²å½©ç©ºé—´æ²¡æœ‰å‡½æ•°æ˜ å°„å…³ç³»çš„è‰²å½©æ¨¡å‹æˆ–å¤šæˆ–å°‘åœ°éƒ½æ˜¯ä¸ç‰¹å®šåº”ç”¨è¦æ±‚å‡ ä¹æ²¡æœ‰å…³ç³»çš„ä»»æ„è‰²å½©ç³»ç»Ÿã€‚</p>
<footer><strong>@Wiki</strong><cite><a href="https://zh.wikipedia.org/wiki/%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%96%93" target="_blank" rel="external">zh.wikipedia.org/wiki/%E8%89%B2%E5%BD%A9%E7%A9%BA%E9%96%93</a></cite></footer></blockquote>
<h3 id="å¸¸è§å½©è‰²æ¨¡å‹"><a href="#å¸¸è§å½©è‰²æ¨¡å‹" class="headerlink" title="å¸¸è§å½©è‰²æ¨¡å‹"></a>å¸¸è§å½©è‰²æ¨¡å‹</h3><table>
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th>åº”ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>RGB</td>
<td>æœ€é€šç”¨çš„é¢å‘ç¡¬ä»¶çš„æ¨¡å‹</td>
<td>å½©è‰²æ˜¾ç¤ºå™¨ï¼Œå½©è‰²è§†é¢‘æ‘„åƒæœº</td>
</tr>
<tr>
<td>CYM</td>
<td>é¢å‘å°åˆ·</td>
<td>å°åˆ·ï¼Œå½©è‰²æ‰“å°æœº</td>
</tr>
<tr>
<td>HSI</td>
<td>é¢å‘äººçœ¼</td>
<td></td>
</tr>
<tr>
<td>YUV</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="å½©è‰²æ·±åº¦"><a href="#å½©è‰²æ·±åº¦" class="headerlink" title="å½©è‰²æ·±åº¦"></a>å½©è‰²æ·±åº¦</h2><h3 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><blockquote><p>è‰²å½©æ·±åº¦è®¡ç®—æœºå›¾å½¢å­¦é¢†åŸŸè¡¨ç¤ºåœ¨ä½å›¾æˆ–è€…è§†é¢‘å¸§ç¼“å†²åŒºä¸­å‚¨å­˜1åƒç´ çš„é¢œè‰²æ‰€ç”¨çš„ä½æ•°ï¼Œå®ƒä¹Ÿç§°ä¸ºä½/åƒç´ ï¼ˆbppï¼‰ã€‚è‰²å½©æ·±åº¦è¶Šé«˜ï¼Œå¯ç”¨çš„é¢œè‰²å°±è¶Šå¤šã€‚</p>
<footer><strong>@Wiki</strong><cite><a href="https://zh.wikipedia.org/wiki/%E8%89%B2%E5%BD%A9%E6%B7%B1%E5%BA%A6" target="_blank" rel="external">zh.wikipedia.org/wiki/%E8%89%B2%E5%BD%A9%E6%B7%B1%E5%BA%A6</a></cite></footer></blockquote>
<h3 id="å¸¸è§å½©è‰²æ·±åº¦"><a href="#å¸¸è§å½©è‰²æ·±åº¦" class="headerlink" title="å¸¸è§å½©è‰²æ·±åº¦"></a>å¸¸è§å½©è‰²æ·±åº¦</h3><p>å½©è‰²æ·±åº¦æ˜¯ç”¨â€œnä½é¢œè‰²â€ï¼ˆn-bit colourï¼‰æ¥è¯´æ˜çš„ã€‚è‹¥æ·±åº¦æ˜¯nä½ï¼Œå³æœ‰2^nç§é¢œè‰²é€‰æ‹©ï¼Œè€Œå‚¨å­˜æ¯åƒç´ æ‰€ç”¨çš„ä½æ•°å°±æ˜¯næ¯”ç‰¹ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ä½æ•°</th>
<th>é¢œè‰²ç§æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td>2</td>
<td>å•è‰²å…‰ï¼Œé»‘ç™½äºŒè‰²ï¼Œç”¨äºcompact Macintoshesã€‚</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td>4</td>
<td>CGAï¼Œç”¨äºgray-scaleæ—©æœŸçš„NeXTstationåŠcolor Macintoshesã€‚</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td>8</td>
<td>ç”¨äºå¤§éƒ¨åˆ†æ—©æœŸçš„ç”µè„‘æ˜¾ç¤ºå™¨ã€‚</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td>16</td>
<td>ç”¨äºEGAåŠä¸å¸¸è§åŠåœ¨æ›´é«˜çš„åˆ†è¾¨ç‡çš„VGAæ ‡å‡†ï¼Œcolor Macintoshes</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td>32</td>
<td>ç”¨äºOriginal Amiga chipsetã€‚</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td>64</td>
<td>ç”¨äºOriginal Amiga chipsetã€‚</td>
</tr>
<tr>
<td style="text-align:left">7</td>
<td>128</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">8</td>
<td>256</td>
<td>ç”¨äºæœ€æ—©æœŸçš„å½©è‰²Unixå·¥ä½œç«™ï¼Œä½åˆ†è¾¨ç‡çš„VGAï¼ŒSuper VGAï¼ŒAGAï¼Œcolor Macintoshesã€‚</td>
</tr>
<tr>
<td style="text-align:left">9</td>
<td>512</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">10</td>
<td>1024</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">11</td>
<td></td>
<td>ç”¨äºéƒ¨åˆ†ç¡…è°·å›¾å½¢ç³»ç»Ÿï¼ŒNeo Geoï¼Œå½©è‰²NeXTstationåŠAmigaç³»ç»ŸäºHAM modeã€‚</td>
</tr>
<tr>
<td style="text-align:left">12</td>
<td></td>
<td>ç”¨äºéƒ¨åˆ†color Macintoshesã€‚</td>
</tr>
<tr>
<td style="text-align:left">24</td>
<td>16777216</td>
<td>çœŸå½©è‰²ï¼Œèƒ½æä¾›æ¯”è‚‰çœ¼èƒ½è¯†åˆ«æ›´å¤šçš„é¢œè‰²ï¼Œç”¨äºæ‹æ‘„ç…§ç‰‡ã€‚</td>
</tr>
</tbody>
</table>
<h1 id="RGBå½©è‰²æ¨¡å‹"><a href="#RGBå½©è‰²æ¨¡å‹" class="headerlink" title="RGBå½©è‰²æ¨¡å‹"></a>RGBå½©è‰²æ¨¡å‹</h1><p>RGBæ¨¡å‹èµ·æºäºé‡‡ç”¨é˜´æå°„çº¿ç®¡çš„å½©è‰²ç”µè§†ï¼Œæ¯ç§é¢œè‰²å‡ºç°åœ¨çº¢ã€ç»¿ã€è“çš„åŸè‰²å…‰è°±åˆ†é‡é‡ã€‚</p>
<h2 id="å½©è‰²ç©ºé—´åæ ‡ç³»"><a href="#å½©è‰²ç©ºé—´åæ ‡ç³»" class="headerlink" title="å½©è‰²ç©ºé—´åæ ‡ç³»"></a>å½©è‰²ç©ºé—´åæ ‡ç³»</h2><p>æ¨¡å‹åŸºäºç¬›å¡å°”åæ ‡ç³»ï¼Œxyzè½´åˆ†åˆ«ä»£è¡¨RGBï¼Œå½©è‰²å­ç©ºé—´å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="http://ohgqsah1g.bkt.clouddn.com/rgb-model.jpg" class="rgb-color-model" title="RGBå½©è‰²ç«‹æ–¹ä½“ç¤ºæ„å›¾"></p>
<p>è¯¥æ¨¡å‹ä¸ºåŠ è‰²æ¨¡å‹ï¼Œåæ ‡åŸç‚¹è¡¨ç¤ºé»‘è‰²ï¼Œï¼ˆ1ï¼Œ1ï¼Œ1ï¼‰è¡¨ç¤ºç™½è‰²ï¼ŒR/G/Bå€¼å–å€¼èŒƒå›´åœ¨[0,1]</p>
<h2 id="24æ¯”ç‰¹å½©è‰²æ·±åº¦"><a href="#24æ¯”ç‰¹å½©è‰²æ·±åº¦" class="headerlink" title="24æ¯”ç‰¹å½©è‰²æ·±åº¦"></a>24æ¯”ç‰¹å½©è‰²æ·±åº¦</h2><p>åœ¨RGBç©ºé—´ä¸­ï¼Œç”¨äºè¡¨ç¤ºæ¯ä¸ªåƒç´ çš„æ¯”ç‰¹æ•°ç§°ä¸º <em><em>åƒç´ æ·±åº¦</em></em>ã€‚</p>
<p>RGBå½©è‰²æ¨¡å‹ä¸­çš„å›¾åƒæœ‰3ä¸ªåˆ†é‡å›¾åƒç»„æˆï¼Œæ¯ç§åŸè‰²ä¸€å¹…åˆ†é‡å›¾åƒã€‚åœ¨RGBæ˜¾ç¤ºå™¨ä¸­ï¼Œè¿™3å¹…å›¾åƒåœ¨å±å¹•ä¸­æœ€ç»ˆæ··åˆæˆä¸€å¹…å½©è‰²å›¾åƒã€‚é€šå¸¸ï¼Œåˆ†é‡å›¾åƒå¯ä»¥è¡¨ç¤ºä¸ºä¸€å¹…8æ¯”ç‰¹å›¾åƒï¼Œå³RGBå½©è‰²åƒç´ å¯ä»¥è¡¨ç¤ºä¸º24æ¯”ç‰¹æ·±åº¦ã€‚</p>
<p>é€šå¸¸ <em>å…¨å½©å›¾åƒ</em> å³æŒ‡ä¸€å¹…24æ¯”ç‰¹çš„RGBå½©è‰²å›¾åƒï¼Œæ€»å…±å¯è¡¨ç¤º2^24=16777216ç§è‰²å½©ï¼Œå¯¹ä¸‹ä¸‹å›¾çš„å½©è‰²ç«‹æ–¹ä½“</p>
<img src="http://ohgqsah1g.bkt.clouddn.com/rgb-24bit-color-cube.png" class="rgb-24bit-color-cube" title="RGB 24æ¯”ç‰¹å½©è‰²ç«‹æ–¹ä½“">
<h2 id="åˆ†ç¦»è‰²å½©å›¾åƒ"><a href="#åˆ†ç¦»è‰²å½©å›¾åƒ" class="headerlink" title="åˆ†ç¦»è‰²å½©å›¾åƒ"></a>åˆ†ç¦»è‰²å½©å›¾åƒ</h2><p>ä»»æ„ä¸€ä¸ªåƒç´ ç‚¹éƒ½å¯ä»¥åˆ†ç¦»å‡ºRã€Gã€Bå¯¹åº”è‰²å½©æ·±åº¦ï¼Œè€Œä¸€å‰¯å›¾åƒæ‰€æœ‰åƒç´ çš„R/G/Bè‰²å½©æ·±åº¦é›†åˆï¼Œå³æ„æˆäº†è¯¥å›¾åƒçš„RGBåˆ†ç¦»è‰²å½©å›¾åƒã€‚</p>
<table>
<thead>
<tr>
<th><img src="http://ohgqsah1g.bkt.clouddn.com/origin-rgb.png" class="origin-rgb" title="åŸå§‹å›¾åƒ"></th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="http://ohgqsah1g.bkt.clouddn.com/rgb-channel-r.png" class="origin-rgb" title="Ré€šé“åˆ†ç¦»å›¾åƒ"></td>
<td><img src="http://ohgqsah1g.bkt.clouddn.com/rgb-channel-g.png" class="origin-rgb" title="Gé€šé“åˆ†ç¦»å›¾åƒ"></td>
<td><img src="http://ohgqsah1g.bkt.clouddn.com/rgb-channel-b.png" class="origin-rgb" title="Bé€šé“åˆ†ç¦»å›¾åƒ"></td>
</tr>
</tbody>
</table>
<h1 id="CYMå½©è‰²æ¨¡å‹"><a href="#CYMå½©è‰²æ¨¡å‹" class="headerlink" title="CYMå½©è‰²æ¨¡å‹"></a>CYMå½©è‰²æ¨¡å‹</h1><h1 id="HSIå½©è‰²æ¨¡å‹"><a href="#HSIå½©è‰²æ¨¡å‹" class="headerlink" title="HSIå½©è‰²æ¨¡å‹"></a>HSIå½©è‰²æ¨¡å‹</h1><h1 id="YUVå½©è‰²æ¨¡å‹"><a href="#YUVå½©è‰²æ¨¡å‹" class="headerlink" title="YUVå½©è‰²æ¨¡å‹"></a>YUVå½©è‰²æ¨¡å‹</h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;æ‘˜è¦ï¼š ä»‹ç»å›¾ç‰‡å½©è‰²æ¨¡å‹çš„åŸºæœ¬çŸ¥è¯†&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="æ•°å­—å›¾ç‰‡å¤„ç†" scheme="http://blog.snowwalf.com/categories/%E6%95%B0%E5%AD%97%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
    
      <category term="å›¾ç‰‡" scheme="http://blog.snowwalf.com/tags/%E5%9B%BE%E7%89%87/"/>
    
  </entry>
  
  <entry>
    <title>ä¸ƒç‰›äº‘å¯Œåª’ä½“å¤„ç†-å›¾ç‰‡å¤„ç†-imageMogr2</title>
    <link href="http://blog.snowwalf.com/2016/12/20/%E4%B8%83%E7%89%9B%E4%BA%91%E5%AF%8C%E5%AA%92%E4%BD%93%E5%A4%84%E7%90%86-%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86-imageMogr2/"/>
    <id>http://blog.snowwalf.com/2016/12/20/ä¸ƒç‰›äº‘å¯Œåª’ä½“å¤„ç†-å›¾ç‰‡å¤„ç†-imageMogr2/</id>
    <published>2016-12-20T14:58:07.000Z</published>
    <updated>2017-02-18T08:48:06.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>ä¸ƒç‰›äº‘å¯Œåª’ä½“å¤„ç†-å›¾ç‰‡å¤„ç†å‘½ä»¤imageMogr2ä½¿ç”¨ç¤ºä¾‹å’Œdemo</em><br><a id="more"></a></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸ƒç‰›äº‘çš„å®˜æ–¹å¯Œåª’ä½“å¤„ç†æŠ€æœ¯æ–‡æ¡£: </p>
<p><a href="http://developer.qiniu.com/code/v6/api/kodo-api/image/index.html" target="_blank" rel="external">http://developer.qiniu.com/code/v6/api/kodo-api/image/index.html</a></p>
<h1 id="ç¼©æ”¾-thumbnail"><a href="#ç¼©æ”¾-thumbnail" class="headerlink" title="ç¼©æ”¾(thumbnail)"></a>ç¼©æ”¾(thumbnail)</h1><p><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg" target="_blank" rel="external">http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg</a><br>åŸå§‹å›¾ç‰‡ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;format&quot;: &quot;jpeg&quot;,</div><div class="line">    &quot;width&quot;: 640,</div><div class="line">    &quot;height&quot;: 427,</div><div class="line">    &quot;colorModel&quot;: &quot;ycbcr&quot;,</div><div class="line">    &quot;orientation&quot;: &quot;Top-left&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="æŒ‰æ¯”ä¾‹ç¼©æ”¾"><a href="#æŒ‰æ¯”ä¾‹ç¼©æ”¾" class="headerlink" title="æŒ‰æ¯”ä¾‹ç¼©æ”¾"></a>æŒ‰æ¯”ä¾‹ç¼©æ”¾</h2><h3 id="ç­‰æ¯”ç¼©æ”¾-ç­‰æ¯”ç¼©å°75"><a href="#ç­‰æ¯”ç¼©æ”¾-ç­‰æ¯”ç¼©å°75" class="headerlink" title="ç­‰æ¯”ç¼©æ”¾(ç­‰æ¯”ç¼©å°75%)"></a>ç­‰æ¯”ç¼©æ”¾(ç­‰æ¯”ç¼©å°75%)</h3><p><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/thumbnail/!75p" target="_blank" rel="external">http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/thumbnail/!75p</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/thumbnail-percentage-1.jpg?imageMogr2/thumbnail/!75p" class="thumbnail-75p" title="ç­‰æ¯”ç¼©å°75% imageMogr2/thumbnail/!75p"></p>
<h3 id="å®½ä¸å˜ï¼Œé«˜ç¼©æ”¾-é«˜ç¼©å°75"><a href="#å®½ä¸å˜ï¼Œé«˜ç¼©æ”¾-é«˜ç¼©å°75" class="headerlink" title="å®½ä¸å˜ï¼Œé«˜ç¼©æ”¾(é«˜ç¼©å°75%)"></a>å®½ä¸å˜ï¼Œé«˜ç¼©æ”¾(é«˜ç¼©å°75%)</h3><p><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/thumbnail/!x75p" target="_blank" rel="external">http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/thumbnail/!x75p</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/thumbnail-percentage-2.jpg?imageMogr2/thumbnail/!75p" class="thumbnail-x75p" title="é«˜ç¼©å°75% imageMogr2/thumbnail/!x75p"></p>
<h3 id="é«˜ä¸å˜ï¼Œå®½ç¼©æ”¾-å®½ç¼©å°75"><a href="#é«˜ä¸å˜ï¼Œå®½ç¼©æ”¾-å®½ç¼©å°75" class="headerlink" title="é«˜ä¸å˜ï¼Œå®½ç¼©æ”¾(å®½ç¼©å°75%)"></a>é«˜ä¸å˜ï¼Œå®½ç¼©æ”¾(å®½ç¼©å°75%)</h3><p><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/thumbnail/!75px" target="_blank" rel="external">http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/thumbnail/!75px</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/thumbnail-percentage-3.jpg?imageMogr2/thumbnail/!75p" class="thumbnail-75px" title="å®½ç¼©å°75% imageMogr2/thumbnail/!75px"></p>
<h1 id="è£å‰ª-crop"><a href="#è£å‰ª-crop" class="headerlink" title="è£å‰ª(crop)"></a>è£å‰ª(crop)</h1><h2 id="é‡å¿ƒå‚æ•°è¡¨"><a href="#é‡å¿ƒå‚æ•°è¡¨" class="headerlink" title="é‡å¿ƒå‚æ•°è¡¨"></a>é‡å¿ƒå‚æ•°è¡¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">NorthWest     |     North      |     NorthEast</div><div class="line">              |                |    </div><div class="line">              |                |    </div><div class="line">--------------+----------------+--------------</div><div class="line">              |                |    </div><div class="line">West          |     Center     |          East </div><div class="line">              |                |    </div><div class="line">--------------+----------------+--------------</div><div class="line">              |                |    </div><div class="line">              |                |    </div><div class="line">SouthWest     |     South      |     SouthEast</div></pre></td></tr></table></figure>
<h2 id="é‡å¿ƒå’ŒX-Yè½´æ­£å€¼æ–¹å‘"><a href="#é‡å¿ƒå’ŒX-Yè½´æ­£å€¼æ–¹å‘" class="headerlink" title="é‡å¿ƒå’ŒX-Yè½´æ­£å€¼æ–¹å‘"></a>é‡å¿ƒå’ŒX-Yè½´æ­£å€¼æ–¹å‘</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">NorthWest     |     North      |     NorthEast</div><div class="line">   ------&gt;x   |      ------&gt;x  |     x&lt;------</div><div class="line">  |           |     |          |             |</div><div class="line">  |           |     |          |             |</div><div class="line">  |           |     |          |             |</div><div class="line">  v           |     v          |             v</div><div class="line"> y            |    y           |              y</div><div class="line">--------------+----------------+---------------</div><div class="line">West          |     Center     |          East </div><div class="line">   ------&gt;x   |      ------&gt;x  |     x&lt;------ </div><div class="line">  |           |     |          |             |</div><div class="line">  |           |     |          |             |</div><div class="line">  |           |     |          |             |</div><div class="line">  v           |     v          |             v</div><div class="line"> y            |    y           |              y</div><div class="line">--------------+----------------+---------------</div><div class="line"> y            |    y           |              y</div><div class="line">  ^           |     ^          |             ^</div><div class="line">  |           |     |          |             |</div><div class="line">  |           |     |          |             |</div><div class="line">  |           |     |          |             |</div><div class="line">   ------&gt;x   |      ------&gt;x  |     x&lt;------ </div><div class="line">SouthWest     |     South      |     SouthEast</div></pre></td></tr></table></figure>
<h2 id="è£å‰ªåç§»"><a href="#è£å‰ªåç§»" class="headerlink" title="è£å‰ªåç§»"></a>è£å‰ªåç§»</h2><h3 id="gravity-NorthWest-é»˜è®¤é‡å¿ƒå‚æ•°-ï¼Œè£å‰ªå‚æ•°300x300"><a href="#gravity-NorthWest-é»˜è®¤é‡å¿ƒå‚æ•°-ï¼Œè£å‰ªå‚æ•°300x300" class="headerlink" title="gravity=NorthWest (é»˜è®¤é‡å¿ƒå‚æ•°)ï¼Œè£å‰ªå‚æ•°300x300"></a>gravity=NorthWest (é»˜è®¤é‡å¿ƒå‚æ•°)ï¼Œè£å‰ªå‚æ•°300x300</h3><table>
<thead>
<tr>
<th style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300-30-30" target="_blank" rel="external">x:-30 y:-30</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300-30-30.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-300x300a0-30-30" title="imageMogr2/crop/!300x300-30-30"></th>
<th style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300a0-30" target="_blank" rel="external">x:0 y:-30</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300a0-30.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-300x300a0-30" title="imageMogr2/crop/!300x300a0-30"></th>
<th style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300a30-30" target="_blank" rel="external">x:+30 y:-30</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300a30-30.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-300x300a30-30" title="imageMogr2/crop/!300x300a30-30"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300-30" target="_blank" rel="external">x:-30 y:0</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300-30a0.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-300x300-30" title="imageMogr2/crop/!300x300-30"></td>
<td style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/300x300" target="_blank" rel="external">x:0 y:0</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300.jpg?imageMogr2/thumbnail/!50p" class="crop-northwest-300x300" title="imageMogr2/crop/300x300"></td>
<td style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300a30" target="_blank" rel="external">x:+30 y:0</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300a30.jpg?imageMogr2/thumbnail/!50p" class="crop-northwest-!300x300a30" title="imageMogr2/crop/!300x300a30"></td>
</tr>
<tr>
<td style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300-30a30" target="_blank" rel="external">x:-30 y:+30</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300-30a30.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-300x300-30a30" title="imageMogr2/crop/!300x300-30a30"></td>
<td style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300a0a30" target="_blank" rel="external">x:0 y:+30</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300a0a30.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-300x300a0a30" title="imageMogr2/crop/!300x300a0a30"></td>
<td style="text-align:center"><a href="http://78re52.com1.z0.glb.clouddn.com/resource/gogopher.jpg?imageMogr2/gravity/NorthWest/crop/!300x300a30a30" target="_blank" rel="external">x:+30 y:+30</a><br><img src="http://ohgqsah1g.bkt.clouddn.com/image/qiniu/img/imageMogr2/northwest-300x300a30a30.jpg?imageMogr2/thumbnail/!75p" class="crop-northwest-!300x300a30a30" title="imageMogr2/crop/!300x300a30a30"></td>
</tr>
</tbody>
</table>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;ä¸ƒç‰›äº‘å¯Œåª’ä½“å¤„ç†-å›¾ç‰‡å¤„ç†å‘½ä»¤imageMogr2ä½¿ç”¨ç¤ºä¾‹å’Œdemo&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ä¸ƒç‰›" scheme="http://blog.snowwalf.com/categories/%E4%B8%83%E7%89%9B/"/>
    
    
      <category term="ä¸ƒç‰›" scheme="http://blog.snowwalf.com/tags/%E4%B8%83%E7%89%9B/"/>
    
      <category term="å›¾ç‰‡å¤„ç†" scheme="http://blog.snowwalf.com/tags/%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/"/>
    
      <category term="imageMogr2" scheme="http://blog.snowwalf.com/tags/imageMogr2/"/>
    
  </entry>
  
  <entry>
    <title>ffmpegæ·»åŠ å›¾ç‰‡æ°´å°çš„ç•¸å˜é—®é¢˜</title>
    <link href="http://blog.snowwalf.com/2016/12/12/ffmpeg-watermark/"/>
    <id>http://blog.snowwalf.com/2016/12/12/ffmpeg-watermark/</id>
    <published>2016-12-12T14:38:35.000Z</published>
    <updated>2016-12-15T14:10:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>æ‘˜è¦ï¼š éŸ³è§†é¢‘æ·»åŠ å›¾ç‰‡æ°´å°æ—¶ï¼ŒSAR/DARä¼šé€ æˆå›¾ç‰‡æ°´å°éšå¸§ç”»é¢ç•¸å˜ã€‚æœ¬æ–‡å°†åˆ†æç•¸å˜äº§ç”ŸåŸå› å’Œæ¢ç´¢è§£å†³æ–¹æ¡ˆ</em><br><a id="more"></a></p>
<h1 id="PAR-SAR-DAR"><a href="#PAR-SAR-DAR" class="headerlink" title="PAR/SAR/DAR"></a>PAR/SAR/DAR</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li>PAR(Pixel Aspect Ratio) åƒç´ å®½é«˜æ¯”ï¼šå•ä¸ªåƒç´ çš„å®½é«˜æ¯”ï¼Œé€šå¸¸è¯¥å€¼ä¸º1ï¼Œå³æ­£æ–¹å½¢åƒç´ ï¼›è‹¥ä¸ä¸º1ï¼Œåˆ™ä¸ºé•¿æ–¹å½¢åƒç´ ã€‚</li>
<li>SAR(Sample Aspect Ratio) é‡‡æ ·çºµæ¨ªæ¯”ï¼šè§†é¢‘æ¨ªå‘å¯¹åº”çš„åƒç´ ä¸ªæ•°æ¯”ä¸Šè§†é¢‘çºµå‘çš„åƒç´ ä¸ªæ•°ï¼Œå³ä¸ºæˆ‘ä»¬é€šå¸¸æåˆ°çš„åˆ†è¾¨ç‡ã€‚</li>
<li>DAR(Display Aspect Ratio) æ˜¾ç¤ºå®½é«˜æ¯”ï¼šç»ˆç«¯æ˜¾ç¤ºæ—¶ï¼Œæ’­æ”¾ç”»é¢çš„å®½é«˜æ¯”ã€‚</li>
</ul>
<h2 id="è®¡ç®—å…¬å¼"><a href="#è®¡ç®—å…¬å¼" class="headerlink" title="è®¡ç®—å…¬å¼"></a>è®¡ç®—å…¬å¼</h2><p><em><strong>SAR x PAR = DAR</strong></em></p>
<p>é€šè¿‡ä¸Šè¿°å…¬å¼ï¼Œå¯ä»¥æ ¹æ®SARã€PARã€DARä¸­çš„ä¸¤ä¸ªè®¡ç®—å‡ºå¦å¤–ä¸€ä¸ª</p>
<h2 id="ffmpegä¸­çš„åˆ†è¾¨ç‡ã€SARã€DAR"><a href="#ffmpegä¸­çš„åˆ†è¾¨ç‡ã€SARã€DAR" class="headerlink" title="ffmpegä¸­çš„åˆ†è¾¨ç‡ã€SARã€DAR"></a>ffmpegä¸­çš„åˆ†è¾¨ç‡ã€SARã€DAR</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªæ ·ä¾‹è§†é¢‘çš„<a href="http://media-resource.com0.z0.glb.qiniucdn.com/%E4%B8%83%E7%89%9B%E4%BA%91%E5%AD%98%E5%82%A8%E8%A7%86%E9%A2%91%EF%BC%8D%E4%B8%89%E5%91%A8%E5%B9%B4.mp4?avinfo" target="_blank" rel="external">è§†é¢‘ä¿¡æ¯</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&quot;width&quot;: 1920,</div><div class="line">&quot;height&quot;: 1080,</div><div class="line">&quot;coded_width&quot;: 1920,</div><div class="line">&quot;coded_height&quot;: 1088,</div><div class="line">&quot;has_b_frames&quot;: 2,</div><div class="line">&quot;sample_aspect_ratio&quot;: &quot;1:1&quot;,</div><div class="line">&quot;display_aspect_ratio&quot;: &quot;16:9&quot;,</div><div class="line">&quot;pix_fmt&quot;: &quot;yuv420p&quot;,</div></pre></td></tr></table></figure></p>
<p>åˆ†æä¸Šè¿°æ ·ä¾‹è§†é¢‘çš„avinfoä¿¡æ¯å¯çŸ¥ï¼š</p>
<ul>
<li>åˆ†è¾¨ç‡=1920x108</li>
<li>sar=1:1</li>
<li>dar=16:9</li>
</ul>
<p>å®é™…ä¸Šï¼Œç”±äºé€šå¸¸PAR=1:1ï¼Œä½¿å¾—å¸§ç”»é¢çš„å®½é«˜æ¯”=åˆ†è¾¨ç‡ï¼ˆå³å®½é«˜åƒç´ æ•°ç›®ï¼‰</p>
<p>æ­¤æ—¶ï¼Œffmpegå¯¹äºåˆ†è¾¨ç‡ã€sarã€daræœ‰å¦‚ä¸‹å…¬å¼ï¼š</p>
<p><em><strong>W/H * SAR = DAR</strong></em></p>
<p>ä¸Šè¿°æ ·ä¾‹è§†é¢‘ï¼Œ1920/1080 * (1/1) = 16:9</p>
<p>å†çœ‹å¦å¤–ä¸€ä¸ªæ ·ä¾‹è§†é¢‘çš„<a href="http://ohgqsah1g.bkt.clouddn.com/water.mp4?avinfo" target="_blank" rel="external">è§†é¢‘ä¿¡æ¯</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&quot;width&quot;: 480,</div><div class="line">&quot;height&quot;: 320,</div><div class="line">&quot;coded_width&quot;: 480,</div><div class="line">&quot;coded_height&quot;: 320,</div><div class="line">&quot;has_b_frames&quot;: 2,</div><div class="line">&quot;sample_aspect_ratio&quot;: &quot;32:27&quot;,</div><div class="line">&quot;display_aspect_ratio&quot;: &quot;16:9&quot;,</div><div class="line">&quot;pix_fmt&quot;: &quot;yuv420p&quot;,</div></pre></td></tr></table></figure></p>
<p>ä¸Šè¿°è§†é¢‘ï¼Œ480/320 * (32/27) = 16/9</p>
<h1 id="æ°´å°ç•¸å˜"><a href="#æ°´å°ç•¸å˜" class="headerlink" title="æ°´å°ç•¸å˜"></a>æ°´å°ç•¸å˜</h1><h2 id="æ’­æ”¾å½¢å˜"><a href="#æ’­æ”¾å½¢å˜" class="headerlink" title="æ’­æ”¾å½¢å˜"></a>æ’­æ”¾å½¢å˜</h2><p>ä¸€èˆ¬è§†é¢‘ç»ˆç«¯æ’­æ”¾æ˜¯å¦å‘ç”Ÿå½¢å˜ï¼Œå¯ä»¥æ ¹æ®å¦‚ä¸‹å‚æ•°æ¥åˆ¤å®šï¼š</p>
<ul>
<li>å½“SAR=1:1æ—¶ï¼Œåˆ†è¾¨ç‡å®½é«˜æ¯” = DARï¼Œè¡¨ç¤ºå¸§ç”»é¢åœ¨ç»ˆç«¯æ’­æ”¾æ—¶ä¸ä¼šäº§ç”Ÿå½¢å˜</li>
<li>å½“SAR!=1:1æ—¶ï¼Œåˆ†è¾¨ç‡å®½é«˜æ¯” != DARï¼Œè¡¨ç¤ºå¸§ç”»é¢åœ¨ç»ˆç«¯æ’­æ”¾æ—¶ä¼šäº§ç”Ÿå½¢å˜</li>
</ul>
<h2 id="ç»ˆç«¯æ’­æ”¾å½¢å˜æ–¹å¼"><a href="#ç»ˆç«¯æ’­æ”¾å½¢å˜æ–¹å¼" class="headerlink" title="ç»ˆç«¯æ’­æ”¾å½¢å˜æ–¹å¼"></a>ç»ˆç«¯æ’­æ”¾å½¢å˜æ–¹å¼</h2><p>å½¢å˜æ–¹å¼é€šå¸¸å¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š</p>
<ol>
<li>ä¿æŒçŸ­è¾¹ä¸å˜ï¼Œé•¿è¾¹ç¼©æ”¾</li>
<li>ä¿æŒé•¿è¾¹ä¸å˜ï¼ŒçŸ­è¾¹ç¼©æ”¾</li>
<li>é•¿è¾¹çŸ­è¾¹åŒæ—¶ç¼©æ”¾</li>
</ol>
<p>è‹¥ä»¥æ ·ä¾‹è§†é¢‘äºŒä¸ºä¾‹ï¼Œä¸Šè¿°ä¸‰ç§å½¢å˜æ–¹å¼å¯å¾—ï¼š</p>
<ol>
<li>åŸå§‹ç”»é¢480x320ï¼ŒçŸ­è¾¹ä¿æŒä¸å˜ï¼Œæ­¤æ—¶H=320,DAR=16/9ï¼Œå¾—W=320/9*16=569,å³é•¿è¾¹ç¼©æ”¾æ¯”ä¸º569/480=1.185</li>
<li>åŸå§‹ç”»é¢480x320ï¼Œé•¿è¾¹è¾¹ä¿æŒä¸å˜ï¼Œæ­¤æ—¶W=480,DAR=16/9,å¾—H=480/16*9=270ï¼Œå³çŸ­è¾¹çš„ç¼©æ”¾æ¯”ä¸º270/320=0.84375</li>
<li>æ ¹æ®æ’­æ”¾å™¨å®é™…æƒ…å†µå‘ç”Ÿå˜åŒ–</li>
</ol>
<h2 id="æ’­æ”¾å½¢å˜å¸¦æ¥çš„æ°´å°å½¢å˜"><a href="#æ’­æ”¾å½¢å˜å¸¦æ¥çš„æ°´å°å½¢å˜" class="headerlink" title="æ’­æ”¾å½¢å˜å¸¦æ¥çš„æ°´å°å½¢å˜"></a>æ’­æ”¾å½¢å˜å¸¦æ¥çš„æ°´å°å½¢å˜</h2><p>å›¾ç‰‡æ°´å°é€šå¸¸ç›´æ¥åˆæˆåœ¨åŸå§‹å¸§ç”»é¢ä¸­ï¼Œæ•…æ’­æ”¾ç«¯çš„å½¢å˜ä¼šè¿å¸¦é€ æˆæ°´å°äº§ç”Ÿç•¸å˜</p>
<p>ä»¥ä¸Šè¿°å½¢å˜æ–¹å¼1ä¸ºä¾‹ï¼Œå‡è®¾ä¸ºåŸå§‹è§†é¢‘æ‰“ä¸Šä¸€ä¸ª40x40çš„æ–¹å½¢æ°´å°ï¼Œåœ¨ç»ˆç«¯æ’­æ”¾æ—¶ï¼Œé•¿è¾¹ä¼šè¿›è¡Œ1.185å€çš„ç¼©æ”¾ï¼Œæ•…å®é™…æ°´å°æ˜¾ç¤ºå¤§å°çº¦ä¸º47x40ï¼Œç•¸å˜æˆä¸ºä¸€ä¸ªé•¿æ–¹å½¢æ°´å°</p>
<h1 id="å›¾ç‰‡æ°´å°ç•¸å˜çš„è§£å†³æ–¹æ¡ˆ"><a href="#å›¾ç‰‡æ°´å°ç•¸å˜çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="å›¾ç‰‡æ°´å°ç•¸å˜çš„è§£å†³æ–¹æ¡ˆ"></a>å›¾ç‰‡æ°´å°ç•¸å˜çš„è§£å†³æ–¹æ¡ˆ</h1><p>åœ¨å®é™…çš„ç”Ÿäº§åº”ç”¨ä¸­ï¼Œæœ‰äº›éœ€æ±‚æ°´å°è¦ä¿æŒåŸå§‹çš„é•¿å®½æ¯”ï¼Œä¸èƒ½å‘ç”Ÿç•¸å˜ï¼Œæ­¤æ—¶éœ€è¦å¯¹å›¾ç‰‡æ°´å°ç•¸å˜è¿›è¡Œä¿®æ­£</p>
<h2 id="åå‘ä¿®æ­£æ°´å°å›¾ç‰‡"><a href="#åå‘ä¿®æ­£æ°´å°å›¾ç‰‡" class="headerlink" title="åå‘ä¿®æ­£æ°´å°å›¾ç‰‡"></a>åå‘ä¿®æ­£æ°´å°å›¾ç‰‡</h2><p>é¡¾åæ€ä¹‰ï¼Œç”±äºç•¸å˜å‘ç”Ÿåœ¨æ’­æ”¾ç»ˆç«¯ï¼Œæ•…å¯ä»¥é¢„æµ‹ç•¸å˜è¡Œä¸ºï¼Œé¢„å…ˆå°†æ°´å°å›¾ç‰‡å˜å½¢åå†å‹å…¥åŸå§‹å¸§ç”»é¢ï¼Œé¢„å˜å½¢å›¾ç‰‡ä¼šæŒ‰é¢„æœŸç•¸å˜åæ¢å¤æ­£å¸¸</p>
<p>ä»¥æ ·ä¾‹è§†é¢‘äºŒä¸ºä¾‹ï¼Œæ·»åŠ 40x40çš„æ°´å°ï¼Œå‡è®¾é‡‡ç”¨ç¬¬ä¸€ç§å½¢å˜æ–¹å¼ï¼š</p>
<ol>
<li>è®¡ç®—å¯çŸ¥ï¼ŒåŸå§‹å¸§ç”»é¢æ¨ªè¾¹ç¼©æ”¾æ¯”ä¸º1.185</li>
<li>åå‘å‹ç¼©æ°´å°è§†é¢‘W=40/1.185=34ï¼Œå³å°†æ°´å°å›¾ç‰‡å‹ç¼©æˆä¸º34x40</li>
<li>ç»ˆç«¯æ’­æ”¾ï¼Œæ ¹æ®ç¬¬ä¸€ç§å½¢å˜æ–¹å¼ï¼Œé•¿è¾¹ç¼©æ”¾ï¼Œå›¾ç‰‡æ°´å°Wâ€™=34*1.185=40ï¼Œå³æ¢å¤åˆ°40x40çš„æ°´å°å›¾ç‰‡</li>
</ol>
<p>ç¬¬äºŒç§å½¢å˜æ–¹å¼å¤„ç†æ–¹å¼ç›¸åŒ</p>
<p><font color="red">ä¸Šè¿°æ–¹å¼å­˜åœ¨é—®é¢˜</font>ï¼š</p>
<p>å¦‚æœé¢„æµ‹çš„å½¢å˜æ–¹å¼ä¸ç»ˆç«¯å®é™…å½¢å˜æ–¹å¼ä¸åŒï¼Œå¯èƒ½é€ æˆæ°´å°å›¾ç‰‡ç­‰æ¯”ç¼©æ”¾</p>
<p>æ¯”å¦‚ï¼Œé¢„æµ‹ç¬¬ä¸€ç§å½¢å˜æ–¹å¼ï¼Œå®é™…ç»ˆç«¯æ’­æ”¾é‡‡ç”¨ç¬¬äºŒä¸­å½¢å˜æ–¹å¼ï¼š</p>
<ol>
<li>æ°´å°å›¾ç‰‡å‹ç¼©å34x40</li>
<li>ç»ˆç«¯æ’­æ”¾æ—¶ï¼ŒçŸ­è¾¹ç¼©æ”¾æ¯”ä¸º0.84375ï¼Œæ’­æ”¾æ—¶æ°´å°é«˜H=40*0.84375=34ï¼Œå³æ°´å°å›¾ç‰‡å®é™…æ’­æ”¾å¤§å°ä¸º34x34ï¼Œå³å®é™…æ°´å°ç­‰æ¯”ç¼©æ”¾äº†0.84375å€</li>
</ol>
<p>è€Œè‹¥æ˜¯ç»ˆç«¯æ’­æ”¾é‡‡ç”¨ç¬¬ä¸‰ç§å½¢å˜æ–¹å¼ï¼Œåˆ™æ°´å°å›¾ç‰‡ç•¸å˜ä¸å¯é¢„æµ‹ï¼Œæ•…ä¿®æ­£åä»å¯èƒ½ç•¸å˜</p>
<p><em>ï¼ˆç”±äºæ’­æ”¾å½¢å˜å–å†³çš„ç»ˆç«¯è¡Œä¸ºï¼Œæ•…å¯¹æ°´å°ç•¸å˜çš„æƒ…å†µå¹¶ä¸èƒ½å‡†ç¡®é¢„æµ‹ï¼Œä¸åŒçš„ç•¸å˜æ¨¡å¼çš„ä¿®æ­£æ–¹å¼ä¸ä¸€æ ·ï¼Œåšä¸»ä»…èƒ½æ®å·¥ä½œä¸­çš„å®é™…å¤„ç†æƒ…å†µç»™å‡ºä¸€äº›è§£å†³æ–¹æ¡ˆï¼Œæ¬¢è¿å¤§å®¶æŒ‡æ­£ï¼‰</em></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;æ‘˜è¦ï¼š éŸ³è§†é¢‘æ·»åŠ å›¾ç‰‡æ°´å°æ—¶ï¼ŒSAR/DARä¼šé€ æˆå›¾ç‰‡æ°´å°éšå¸§ç”»é¢ç•¸å˜ã€‚æœ¬æ–‡å°†åˆ†æç•¸å˜äº§ç”ŸåŸå› å’Œæ¢ç´¢è§£å†³æ–¹æ¡ˆ&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="éŸ³è§†é¢‘å¤„ç†" scheme="http://blog.snowwalf.com/categories/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/"/>
    
    
      <category term="ffmpeg" scheme="http://blog.snowwalf.com/tags/ffmpeg/"/>
    
      <category term="éŸ³è§†é¢‘" scheme="http://blog.snowwalf.com/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/"/>
    
      <category term="è§†é¢‘æ°´å°" scheme="http://blog.snowwalf.com/tags/%E8%A7%86%E9%A2%91%E6%B0%B4%E5%8D%B0/"/>
    
  </entry>
  
  <entry>
    <title>CPUé«˜é€Ÿç¼“å­˜è¡Œå¯¹é½</title>
    <link href="http://blog.snowwalf.com/2011/09/17/CPU%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98%E8%A1%8C%E5%AF%B9%E9%BD%90/"/>
    <id>http://blog.snowwalf.com/2011/09/17/CPUé«˜é€Ÿç¼“å­˜è¡Œå¯¹é½/</id>
    <published>2011-09-17T01:48:00.000Z</published>
    <updated>2016-12-15T14:38:16.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº†CPUé«˜é€Ÿç¼“å­˜ä»¥åŠé«˜é€Ÿç¼“å­˜è¡Œå¯¹é½ï¼Œæ¢ç´¢ç¼–ç¨‹ä¸­å¯¹äºè¡Œå¯¹é½çš„ä¼˜åŒ–</em><br><a id="more"></a></p>
<h1 id="CPUé«˜é€Ÿç¼“å­˜"><a href="#CPUé«˜é€Ÿç¼“å­˜" class="headerlink" title="CPUé«˜é€Ÿç¼“å­˜"></a>CPUé«˜é€Ÿç¼“å­˜</h1><p>CPUçš„é«˜é€Ÿç¼“å­˜ä¸€èˆ¬åˆ†ä¸ºä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œç°ä»Šæ›´å¤šçš„CPUæ›´æ˜¯æä¾›äº†ä¸‰çº§ç¼“å­˜ã€‚</p>
<p>CPUåœ¨è¿è¡Œæ—¶é¦–å…ˆä»ä¸€çº§ç¼“å­˜è¯»å–æ•°æ®ï¼Œå¦‚æœè¯»å–å¤±è´¥åˆ™ä¼šä»äºŒçº§ç¼“å­˜è¯»å–æ•°æ®ï¼Œå¦‚æœä»ç„¶å¤±è´¥åˆ™å†ä»å†…å­˜ä¸­å­˜è¯»å–æ•°æ®ã€‚è€ŒCPUä»ä¸€çº§ç¼“å­˜æˆ–äºŒçº§ç¼“å­˜æˆ–ä¸»å†…å­˜ä¸­æœ€ç»ˆè¯»å–åˆ°æ•°æ®æ‰€è€—è´¹çš„æ—¶é’Ÿå‘¨æœŸå·®è·æ˜¯éå¸¸ä¹‹å¤§çš„ã€‚å› æ­¤é«˜é€Ÿç¼“å­˜çš„å®¹é‡å’Œé€Ÿåº¦ç›´æ¥å½±å“åˆ°CPUçš„å·¥ä½œæ€§èƒ½ã€‚</p>
<p>ä¸€çº§ç¼“å­˜éƒ½å†…ç½®åœ¨CPUå†…éƒ¨å¹¶ä¸CPUåŒé€Ÿè¿è¡Œï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜CPUçš„è¿è¡Œæ•ˆç‡ã€‚ä¸€çº§ç¼“å­˜è¶Šå¤§ï¼ŒCPUçš„è¿è¡Œæ•ˆç‡å¾€å¾€è¶Šé«˜ã€‚</p>
<h1 id="é«˜é€Ÿç¼“å­˜è¡Œå¯¹é½"><a href="#é«˜é€Ÿç¼“å­˜è¡Œå¯¹é½" class="headerlink" title="é«˜é€Ÿç¼“å­˜è¡Œå¯¹é½"></a>é«˜é€Ÿç¼“å­˜è¡Œå¯¹é½</h1><h2 id="å•CPUç¼“å­˜è¡Œå¯¹é½"><a href="#å•CPUç¼“å­˜è¡Œå¯¹é½" class="headerlink" title="å•CPUç¼“å­˜è¡Œå¯¹é½"></a>å•CPUç¼“å­˜è¡Œå¯¹é½</h2><p>ä¸€çº§ç¼“å­˜åˆåˆ†ä¸ºæ•°æ®ç¼“å­˜å’ŒæŒ‡ä»¤ç¼“å­˜ï¼Œä»–ä»¬éƒ½ç”±é«˜é€Ÿç¼“å­˜è¡Œç»„æˆï¼Œå¯¹äºX86æ¶æ„çš„CPUæ¥è¯´ï¼Œé«˜é€Ÿç¼“å­˜è¡Œä¸€èˆ¬æ˜¯32ä¸ªå­—èŠ‚ï¼Œæ—©æœŸçš„CPUå¤§çº¦åªæœ‰512è¡Œé«˜é€Ÿç¼“å­˜è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´çº¦16kçš„ä¸€çº§ç¼“å­˜ã€‚è€Œç°åœ¨çš„CPUä¸€èˆ¬éƒ½æ˜¯32Kä»¥ä¸Šçš„ä¸€çº§ç¼“å­˜ã€‚</p>
<p>å½“CPUéœ€è¦è¯»å–ä¸€ä¸ªå˜é‡æ—¶ï¼Œè¯¥å˜é‡æ‰€åœ¨çš„ä»¥32å­—èŠ‚åˆ†ç»„çš„å†…å­˜æ•°æ®å°†è¢«ä¸€åŒè¯»å…¥é«˜é€Ÿç¼“å­˜è¡Œï¼Œæ‰€ä»¥ï¼Œå¯¹äºæ€§èƒ½è¦æ±‚ä¸¥æ ¼çš„ç¨‹åºæ¥è¯´ï¼Œå……åˆ†åˆ©ç”¨é«˜é€Ÿç¼“å­˜è¡Œçš„ä¼˜åŠ¿éå¸¸é‡è¦ã€‚ä¸€æ¬¡æ€§å°†è®¿é—®é¢‘ç¹çš„32å­—èŠ‚æ•°æ®å¯¹é½åè¯»å…¥é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå‡å°‘CPUé«˜çº§ç¼“å­˜ä¸ä½çº§ç¼“å­˜ã€å†…å­˜çš„æ•°æ®äº¤æ¢ã€‚</p>
<h2 id="å¤šCPUç¼“å­˜è¡Œå¯¹é½"><a href="#å¤šCPUç¼“å­˜è¡Œå¯¹é½" class="headerlink" title="å¤šCPUç¼“å­˜è¡Œå¯¹é½"></a>å¤šCPUç¼“å­˜è¡Œå¯¹é½</h2><p>å¯¹äºå¤šCPUçš„è®¡ç®—æœºï¼Œæƒ…å†µå´åˆä¸ä¸€æ ·äº†ï¼š</p>
<ol>
<li>CPU1è¯»å–äº†ä¸€ä¸ªå­—èŠ‚ï¼Œä»¥åŠå®ƒå’Œå®ƒç›¸é‚»çš„å­—èŠ‚è¢«è¯»å…¥ CPU1 çš„é«˜é€Ÿç¼“å­˜ã€‚</li>
<li>CPU2åšäº†ä¸Šé¢åŒæ ·çš„å·¥ä½œã€‚è¿™æ · CPU1ï¼ŒCPU2 çš„é«˜é€Ÿç¼“å­˜æ‹¥æœ‰åŒæ ·çš„æ•°æ®ã€‚</li>
<li>CPU1ä¿®æ”¹äº†é‚£ä¸ªå­—èŠ‚ï¼Œè¢«ä¿®æ”¹åï¼Œé‚£ä¸ªå­—èŠ‚è¢«æ”¾å›CPU1çš„é«˜é€Ÿç¼“å­˜è¡Œã€‚ä½†æ˜¯è¯¥ä¿¡æ¯å¹¶æ²¡æœ‰è¢«å†™å…¥RAM ã€‚</li>
<li>CPU2è®¿é—®è¯¥å­—èŠ‚ï¼Œä½†ç”±äºCPU1å¹¶æœªå°†æ•°æ®å†™å…¥RAM ï¼Œå¯¼è‡´äº†æ•°æ®ä¸åŒæ­¥ã€‚</li>
</ol>
<p>å½“ä¸€ä¸ªCPUä¿®æ”¹é«˜é€Ÿç¼“å­˜è¡Œä¸­çš„å­—èŠ‚æ—¶ï¼Œè®¡ç®—æœºä¸­çš„å…¶å®ƒCPUä¼šè¢«é€šçŸ¥ï¼Œå®ƒä»¬çš„é«˜é€Ÿç¼“å­˜å°†è§†ä¸ºæ— æ•ˆã€‚äºæ˜¯ï¼Œåœ¨ä¸Šé¢çš„æƒ…å†µä¸‹ï¼Œ CPU2å‘ç°è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ä¸­æ•°æ®å·²æ— æ•ˆï¼Œ CPU1å°†ç«‹å³æŠŠè‡ªå·±çš„æ•°æ®å†™å›RAMï¼Œç„¶åCPU2é‡æ–°è¯»å–è¯¥æ•°æ®ã€‚å¯ä»¥çœ‹å‡ºï¼Œé«˜é€Ÿç¼“å­˜è¡Œåœ¨å¤šå¤„ç†å™¨ä¸Šä¼šå¯¼è‡´ä¸€äº›ä¸åˆ©ã€‚</p>
<p>ä»ä¸Šé¢çš„æƒ…å†µå¯ä»¥çœ‹å‡ºï¼Œåœ¨è®¾è®¡æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œåº”è¯¥å°½é‡å°†åªè¯»æ•°æ®ä¸è¯»å†™æ•°æ®åˆ†å¼€ï¼Œå¹¶å…·å°½é‡å°†åŒä¸€æ—¶é—´è®¿é—®çš„æ•°æ®ç»„åˆåœ¨ä¸€èµ·ã€‚è¿™æ ·CPUèƒ½ä¸€æ¬¡å°†éœ€è¦çš„æ•°æ®è¯»å…¥ã€‚</p>
<h1 id="ç¼–ç¨‹ä¸­å¯¹ç¼“å­˜è¡Œå¯¹é½çš„ä¼˜åŒ–"><a href="#ç¼–ç¨‹ä¸­å¯¹ç¼“å­˜è¡Œå¯¹é½çš„ä¼˜åŒ–" class="headerlink" title="ç¼–ç¨‹ä¸­å¯¹ç¼“å­˜è¡Œå¯¹é½çš„ä¼˜åŒ–"></a>ç¼–ç¨‹ä¸­å¯¹ç¼“å­˜è¡Œå¯¹é½çš„ä¼˜åŒ–</h1><p>å‡è®¾æœ‰å¦‚ä¸‹ç»“æ„ä½“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Struct __a</div><div class="line">&#123;</div><div class="line">    Int id; // ä¸æ˜“å˜</div><div class="line">    Int factor;// æ˜“å˜</div><div class="line">    Char name[64];// ä¸æ˜“å˜</div><div class="line">    Int value;// æ˜“å˜</div><div class="line">&#125; ï¼›</div></pre></td></tr></table></figure></p>
<p>æ ¹æ®ä¸Šè¿°è¡Œå¯¹é½åŸæ¥ï¼Œè¿™æ ·çš„æ•°æ®ç»“æ„åœ¨X86æ¶æ„ä¸‹ï¼Œæ‰§è¡Œæ˜¯ä¸åˆ©çš„</p>
<p>å¯ä»¥åšå¦‚ä¸‹è°ƒæ•´ï¼Œä¿è¯è¯»å†™åˆ†ç¦»è¡Œå¯¹é½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Struct __a</div><div class="line">&#123;</div><div class="line">    Int id; // ä¸æ˜“å˜</div><div class="line">    Char name[64];// ä¸æ˜“å˜</div><div class="line">    Char __Align[32 â€“ sizeof(int)+sizeof(name)*sizeof(name[0])%32]</div><div class="line">    Int factor;// æ˜“å˜</div><div class="line">    Int value;// æ˜“å˜</div><div class="line">    Char __Align2[32 â€“2* sizeof(int)%32]</div><div class="line">&#125; ï¼›</div></pre></td></tr></table></figure></p>
<ul>
<li>32 â€“ sizeof(int)+sizeof(name)*sizeof(name[0])%32</li>
<li>32 è¡¨ç¤º X86 æ¶æ„ä¸­ç¼“å­˜ä¸­ï¼Œé«˜é€Ÿç¼“å­˜è¡Œä¸º 32å­—èŠ‚ å¤§å°ã€‚ __Align ç”¨äºæ˜¾å¼å¯¹é½ã€‚</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;æ‘˜è¦ï¼šæœ¬æ–‡ä»‹ç»äº†CPUé«˜é€Ÿç¼“å­˜ä»¥åŠé«˜é€Ÿç¼“å­˜è¡Œå¯¹é½ï¼Œæ¢ç´¢ç¼–ç¨‹ä¸­å¯¹äºè¡Œå¯¹é½çš„ä¼˜åŒ–&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Linuxå†…æ ¸" scheme="http://blog.snowwalf.com/categories/Linux%E5%86%85%E6%A0%B8/"/>
    
    
      <category term="linux" scheme="http://blog.snowwalf.com/tags/linux/"/>
    
      <category term="x86" scheme="http://blog.snowwalf.com/tags/x86/"/>
    
      <category term="æ•°æ®ç»“æ„" scheme="http://blog.snowwalf.com/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>bochs+gdbæºç çº§è°ƒè¯•linux0.12å†…æ ¸æµ‹è¯•ç¯å¢ƒæ„å»º</title>
    <link href="http://blog.snowwalf.com/2011/05/31/bochs-gdb-linux0-12-debug/"/>
    <id>http://blog.snowwalf.com/2011/05/31/bochs-gdb-linux0-12-debug/</id>
    <published>2011-05-31T06:12:00.000Z</published>
    <updated>2016-12-14T16:18:29.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>bochs+gdbæ­å»ºlinux0.12å†…æ ¸æºç è°ƒè¯•ç¯å¢ƒ</em><br><a id="more"></a></p>
<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰éƒ½æ˜¯ç”¨çš„bochsè‡ªå¸¦çš„debugåŠŸèƒ½ï¼Œä½†æ˜¯linuxå†…æ ¸å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨Cè¯­vvè¨€æ¥å®ç°çš„ï¼Œè‹¥ä»…é€šè¿‡åæ±‡ç¼–çš„æ±‡ç¼–æ¥å­¦ä¹ ï¼Œå¤ªç´¯äº†ã€‚ã€‚ã€‚</p>
<p>æ‰€ä»¥ä»Šå¤©èŠ±äº†ä¸€ä¸ªä¸Šåˆçš„æ—¶é—´ï¼Œæ­å»ºèµ·äº†bochs+gbdçš„è”è°ƒç¯å¢ƒã€‚</p>
<h1 id="å®‰è£…bochs"><a href="#å®‰è£…bochs" class="headerlink" title="å®‰è£…bochs"></a>å®‰è£…bochs</h1><p>é¦–å…ˆè¿˜æ˜¯è¦å®‰è£…bochsï¼Œä»ç„¶æ˜¯æ¨èä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬ï¼ˆ2.4.6ï¼‰ï¼Œå¦‚æœä½¿ç”¨åƒ2.3.6ç­‰è€ç‰ˆæœ¬ï¼Œä¹Ÿè®¸ä¼šå¯¼è‡´åé¢ä¸gdbæ— æ³•è¿œç¨‹è¿æ¥ï¼ˆNNDï¼Œå°±æ˜¯è¿™ä¸ªæ¶å¿ƒçš„é—®é¢˜æµªè´¹äº†æˆ‘å‡ ä¸ªå°æ—¶ã€‚ã€‚ã€‚ï¼‰</p>
<p>linuxä¸Šè¿˜æ˜¯è¦ä»bochsçš„æºç ç¼–è¯‘å¼€å§‹å®‰è£…ï¼Œbinæ–‡ä»¶å®‰è£…çš„ç‰ˆæœ¬æ— æ³•æä¾›è°ƒè¯•åŠŸèƒ½ã€‚</p>
<p>é…ç½®bochsæºç æ—¶ï¼Œè¾“å…¥å‘½ä»¤ ./configure â€“enable-gdb-stubï¼Œç„¶åä½¿ç”¨makeå’Œsudo make installå‘½ä»¤å®Œæˆå®‰è£…ã€‚</p>
<p>å®‰è£…æ—¶å¯èƒ½ä¼šé‡åˆ°X windowsåº“ä¸å…¨çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡apt-getå®‰è£…xorg-devè§£å†³ã€‚</p>
<p>å¦‚æœæ˜¯ä»source codeè¿›è¡Œç¼–è¯‘å®‰è£…æ—¶ï¼Œæœ‰å¯èƒ½ä¼šç”¨åˆ°çš„ä¸¤ä¸ªç»„ä»¶åˆ†åˆ«æ˜¯build-essentialå’Œlibxrandr-devï¼Œå„è‡ªä½œç”¨è¯·è‡ªè¡Œæœç´¢ï½</p>
<h1 id="é…ç½®bochs"><a href="#é…ç½®bochs" class="headerlink" title="é…ç½®bochs"></a>é…ç½®bochs</h1><p>é…ç½®bochsè™šæ‹Ÿæœºç¯å¢ƒéœ€è¦ä¸€ä¸ª.bxrcæ–‡ä»¶å’Œç”Ÿäº§ä¸€ä¸ªæ ¹æ–‡ä»¶ç³»ç»Ÿé•œåƒæ–‡ä»¶ï¼Œå»ºè®®ç›´æ¥åˆ°oldlinuxä¸Šä¸‹è½½ä¸€ä¸ªlinux-0.11-gdb-rh9-050619.tar.gzï¼Œå…¶ä¸­å·²ç»åŒ…å«äº†é…ç½®å¥½çš„è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦å¤–åœ¨linuxæ–‡ä»¶å¤¹ä¸‹æœ‰linux0.11çš„æºç ã€‚</p>
<p>.bxrcæ–‡ä»¶ä¸­ä¸»è¦æ˜¯æ·»åŠ äº†ä¸€æ¡è°ƒè¯•ä¿¡æ¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gdbstub: enable=1, port=1234, text_base=0, data_base=0, bss_base=0</div></pre></td></tr></table></figure></p>
<p>å¦å¤–ï¼Œè¿™ä¸ªbxrcæ–‡ä»¶ä¸­éœ€è¦ç¨ç¨ä¿®æ”¹ä¸€äº›ä¸œè¥¿ï¼š</p>
<ol>
<li><p>romimage: file=$BXSHARE/BIOS-bochs-latest,  address=0xf0000 æ”¹æˆ romimage: file=$BXSHARE/BIOS-bochs-latest</p>
</li>
<li><p>floppy_command_delay: 50000 æ”¹æˆ #floppy_command_delay: 50000</p>
</li>
<li><p>3.ips: 4000000 æ”¹æˆ cpu: count=1, ips=4000000</p>
</li>
</ol>
<h1 id="ä½¿ç”¨bochsè¿›è¡Œè”æœºè°ƒè¯•"><a href="#ä½¿ç”¨bochsè¿›è¡Œè”æœºè°ƒè¯•" class="headerlink" title="ä½¿ç”¨bochsè¿›è¡Œè”æœºè°ƒè¯•"></a>ä½¿ç”¨bochsè¿›è¡Œè”æœºè°ƒè¯•</h1><ol>
<li>æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ã€‚</li>
<li>ä¸€ä¸ªç»ˆç«¯è¿›å…¥åˆ°linux-gdb-rh9/ï¼Œè¿è¡Œç¨‹åºâ€./runâ€ï¼Œæ­¤æ—¶çª—å£æ˜¾ç¤ºç­‰å¾…ä¿¡æ¯â€œwait for gdb connection on localhost:1234â€</li>
<li>å¦ä¸€ä¸ªç»ˆç«¯è¿›å…¥linux-gdb-rh9/linux/ï¼Œè¿è¡Œ gdb tools/system</li>
<li>åœ¨gdbçª—å£ä¸­è¾“å…¥b mainï¼ˆåœ¨mainå‡½æ•°å¤„ä¸‹æ–­ï¼‰</li>
<li>è¾“å…¥target remote localhost:1234 ï¼Œè¿æ¥åˆ°bochsè™šæ‹Ÿæœºä¸Š</li>
<li>è¾“å…¥cï¼Œè®©ç¨‹åºæŒç»­è¿è¡Œï¼Œç›´åˆ°ç»ˆç«¯åœ¨mainå‡½æ•°ä¸­</li>
<li>å¯ä»¥å¼€å§‹ä½¿ç”¨gdbè¿›è¡Œæºç è°ƒè¯•äº†^_^</li>
</ol>
<h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><ul>
<li>æ—©æœŸæºç é»˜è®¤çš„æ±‡ç¼–ç¼–è¯‘å™¨ä¸ºgasï¼Œé“¾æ¥å™¨ä¸ºgldï¼Œæ‰€ä»¥åœ¨Makefileæ–‡ä»¶ä¸­æ˜¾ç¤ºå£°æ˜as=gas ld=gldã€‚è€Œåœ¨ubuntu 11.04ä¸­ï¼Œgccæ—©å·²æˆä¸ºé»˜è®¤çš„ç¼–è¯‘å™¨äº†ï¼Œæ‰€ä»¥å¦‚æœæ˜¯å¦å¤–ä¸‹è½½çš„æºç ï¼Œéœ€è¦å°†Makefileä¸­çš„as=gas ld=gldæ”¹æˆ as=asï¼Œ ld=ld</li>
</ul>
<hr>
<p>å…ˆå†™åˆ°è¿™ï¼Œæœ‰åœ¨æƒ³åˆ°çš„ç»§ç»­å•Š~~~^_^</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;bochs+gdbæ­å»ºlinux0.12å†…æ ¸æºç è°ƒè¯•ç¯å¢ƒ&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Linuxå†…æ ¸" scheme="http://blog.snowwalf.com/categories/Linux%E5%86%85%E6%A0%B8/"/>
    
    
      <category term="linux" scheme="http://blog.snowwalf.com/tags/linux/"/>
    
      <category term="bochs" scheme="http://blog.snowwalf.com/tags/bochs/"/>
    
  </entry>
  
  <entry>
    <title>bochsçš„ä½¿ç”¨å¿ƒå¾—</title>
    <link href="http://blog.snowwalf.com/2011/05/28/bochs-experience/"/>
    <id>http://blog.snowwalf.com/2011/05/28/bochs-experience/</id>
    <published>2011-05-28T08:09:00.000Z</published>
    <updated>2016-12-14T16:50:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>bochsçš„ä½¿ç”¨å’Œè°ƒè¯• linuxå†…æ ¸<br><a id="more"></a></p>
<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>bochsçš„ç®€ä»‹å§ï¼Œæ¥è‡ªåº¦å¨˜ï¼š</p>
<blockquote>
<p>Bochsæ˜¯ä¸€ä¸ªx86ç¡¬ä»¶å¹³å°çš„å¼€æºæ¨¡æ‹Ÿå™¨ã€‚å®ƒå¯ä»¥æ¨¡æ‹Ÿå„ç§ç¡¬ä»¶çš„é…ç½®ã€‚Bochsæ¨¡æ‹Ÿçš„æ˜¯æ•´ä¸ªPCå¹³å°ï¼ŒåŒ…æ‹¬I/Oè®¾å¤‡ã€å†…å­˜å’ŒBIOSã€‚æ›´ä¸ºæœ‰è¶£çš„æ˜¯ï¼Œç”šè‡³å¯ä»¥ä¸ä½¿ç”¨PCç¡¬ä»¶æ¥è¿è¡ŒBochsã€‚äº‹å®ä¸Šï¼Œå®ƒå¯ä»¥åœ¨ä»»ä½•ç¼–è¯‘è¿è¡ŒBochsçš„å¹³å°ä¸Šæ¨¡æ‹Ÿx86ç¡¬ä»¶ã€‚é€šè¿‡æ”¹å˜é…ç½®ï¼Œå¯ä»¥æŒ‡å®šä½¿ç”¨çš„CPU(386ã€486æˆ–è€…586)ï¼Œä»¥åŠå†…å­˜å¤§å°ç­‰ã€‚ä¸€å¥è¯ï¼ŒBochsæ˜¯ç”µè„‘é‡Œçš„â€œPCâ€ã€‚æ ¹æ®éœ€è¦ï¼ŒBochsè¿˜å¯ä»¥æ¨¡æ‹Ÿå¤šå°PCï¼Œæ­¤å¤–ï¼Œå®ƒç”šè‡³è¿˜æœ‰è‡ªå·±çš„ç”µæºæŒ‰é’®ã€‚</p>
</blockquote>
<p>ç”¨ä¸‹æ¥æ„Ÿè§‰bochséå¸¸å°å·§ï¼Œç›¸æ¯”äºVMåŠŸèƒ½ä¸Šå¹¶ä¸ç›¸å·®å¾ˆå¤šï¼Œè€Œä¸”å¯¹äºä¸€äº›æ¯”è¾ƒâ€œå¤è‘£â€çš„ç¡¬ä»¶æ¥å£æ”¯æŒæ¯”è¾ƒå¥½ï¼Œé€šè¿‡.bxrcæ–‡ä»¶èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„ç”Ÿäº§å’Œé…ç½®ç¡¬ä»¶ã€‚bochså†…åµŒçš„è°ƒè¯•å™¨æ¯”è¾ƒå¥½ç”¨ï¼Œå¯ä»¥ä»è™šæ‹Ÿæœºé€šç”µåŠ è½½ROM BIOSèµ·å¼€å§‹è°ƒè¯•ï¼Œå¯¹äºäº†è§£æ“ä½œç³»ç»Ÿçš„è¯¦ç»†åŸç†è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚å°±æ˜¯æ²¡æœ‰å›¾å½¢åŒ–å¾—è°ƒè¯•ç•Œé¢æ¯”è¾ƒè›‹ç–¼ã€‚ã€‚ã€‚ç”¨æƒ¯äº†VS,Windbgçš„äººæœ‰ç‚¹å‹åŠ›å¤§ã€‚ã€‚ã€‚ä¸è¿‡æ…¢æ…¢ç”¨å°±ä¹ æƒ¯äº†ã€‚</p>
<h1 id="è·å–bochs"><a href="#è·å–bochs" class="headerlink" title="è·å–bochs"></a>è·å–bochs</h1><p>å¯ä»¥å»Sourceforgeä¸Šä¸‹è½½srcæˆ–è€…binï¼š <a href="http://bochs.sourceforge.net/" target="_blank" rel="external">http://bochs.sourceforge.net/</a>  ï¼ˆlinuxä¸Šå»ºè®®è¿˜æ˜¯ä»srcå¼€å§‹ç¼–è¯‘ï¼Œbinç‰ˆæœ¬ä¸­å¾€å¾€ä¸å¸¦æœ‰bochsdbgè¿™ä¸ªè°ƒè¯•ç¨‹åºã€‚ã€‚ã€‚windowsçš„è¯å¯ä»¥ç›´æ¥ç”¨.exeçš„ï¼Œå®‰è£…å®Œåæ˜¯åŒ…å«dbgç¨‹åºçš„ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯ç”¨çš„windowsç‰ˆ^_^ï¼‰</p>
<p>ä¹Ÿå¯ä»¥å»oldlinuxä¸Šä¸‹è½½ï¼š <a href="http://oldlinux.org/Linux.old/bochs/" target="_blank" rel="external">http://oldlinux.org/Linux.old/bochs/</a><br>èµµç‚¯è€å¸ˆçš„ä¹¦ä¸Šå»ºè®®è°ƒè¯•Linux0.12ä½¿ç”¨çš„æ˜¯bochs2.3.6ï¼Œä½†ç»æˆ‘å®æµ‹å‘ç°æœ€æ–°çš„ç‰ˆæœ¬ï¼ˆç°åœ¨æ˜¯2.4.6ï¼‰ä¹Ÿæ˜¯ä¹Ÿæ˜¯å…¼å®¹çš„ï¼Œè€Œä¸”2.4.6çš„è°ƒè¯•æŒ‡ä»¤ç›¸æ¯”è€ç‰ˆæœ¬æœ‰ä¸å°‘çš„æ”¹è¿›ï¼Œæ‰€ä»¥è¿˜æ˜¯å»ºè®®ä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬ã€‚</p>
<h1 id="å®‰è£…å’Œé…ç½®"><a href="#å®‰è£…å’Œé…ç½®" class="headerlink" title="å®‰è£…å’Œé…ç½®"></a>å®‰è£…å’Œé…ç½®</h1><p>å®‰è£…å’Œé…ç½®æ¯”è¾ƒç®€å•ï¼Œwindowsçš„è¯åªè¦ä¸‹ä¸€æ­¥å°±OKï¼›</p>
<p>linuxä¸Šç¼–è¯‘srcéœ€è¦åœ¨ç¼–è¯‘æ—¶è®¾ç½®ç¼–è¯‘é€‰é¡¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./configure --prefix=/opt/bochs/debug --enable-plugins --enable-debugger --enable- disasm</div></pre></td></tr></table></figure>
<ul>
<li>â€“prefix=/opt/bochs/debug è½¯ä»¶å°†è¢«å®‰è£…åˆ°å“ªä¸ªç›®å½•ä¸‹</li>
<li>â€“enable-plugins æ˜¯å¿…é¡»è¦çš„</li>
<li>â€“enable-debugger æ˜¯æ‰“å¼€bochsçš„è‡ªå¸¦è°ƒè¯•å™¨</li>
<li>â€“enbale-disasm å…è®¸åæ±‡ç¼–</li>
</ul>
<h1 id="è°ƒè¯•æŒ‡ä»¤"><a href="#è°ƒè¯•æŒ‡ä»¤" class="headerlink" title="è°ƒè¯•æŒ‡ä»¤"></a>è°ƒè¯•æŒ‡ä»¤</h1><p>å†æ¥äº›bochsdbgçš„è°ƒè¯•æŒ‡ä»¤å§ï¼Œç½‘ä¸Šæœçš„æœ‰äº›æŒ‡ä»¤å› ä¸ºç‰ˆæœ¬é—®é¢˜å¹¶ä¸èƒ½ä½¿ç”¨ï¼ˆæˆ‘ç”¨çš„æ˜¯2.4.6ï¼‰ï¼š</p>
<h2 id="æ™®é€šæŒ‡ä»¤ç»„"><a href="#æ™®é€šæŒ‡ä»¤ç»„" class="headerlink" title="æ™®é€šæŒ‡ä»¤ç»„"></a>æ™®é€šæŒ‡ä»¤ç»„</h2><table>
<thead>
<tr>
<th>æŒ‡ä»¤æ ¼å¼</th>
<th style="text-align:left">åŠŸèƒ½æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>b addr</td>
<td style="text-align:left">åœ¨ç‰©ç†åœ°å€å¤„è®¾ç½®æ–­ç‚¹ addrä¸ºç‰©ç†å†…å­˜åœ°å€ï¼Œä¸åŠ æ®µåŸºå€</td>
</tr>
<tr>
<td>lb addr</td>
<td style="text-align:left">åœ¨çº¿æ€§åœ°å€å¤„è®¾ç½®æ–­ç‚¹  addrä¸ºçº¿æ€§ç‰©ç†åœ°å€ï¼Œä¸åŠ åŸºå€</td>
</tr>
<tr>
<td>vb addr</td>
<td style="text-align:left">åœ¨è™šæ‹Ÿåœ°å€ä¸Šè®¾ç½®æ–­ç‚¹ addrä¸ºæ®µåŸºå€ï¼šåç§»åœ°å€ï¼Œ csæ®µ</td>
</tr>
<tr>
<td>c</td>
<td style="text-align:left">ç»§ç»­æ‰§è¡ŒçŸ¥é“é‡åˆ°æ–­ç‚¹</td>
</tr>
<tr>
<td>n</td>
<td style="text-align:left">å•æ­¥æ‰§è¡Œ è·³è¿‡å­ç¨‹åºå’Œintä¸­æ–­ç¨‹åº</td>
</tr>
<tr>
<td>s</td>
<td style="text-align:left">å•æ­¥æ‰§è¡Œ</td>
</tr>
<tr>
<td>s num</td>
<td style="text-align:left">æ‰§è¡Œnæ­¥</td>
</tr>
<tr>
<td>dump_cpu</td>
<td style="text-align:left">æŸ¥çœ‹å¯„å­˜å™¨ä¿¡æ¯ï¼ˆå®æµ‹ä¸‹æ¥è¿™ä¸ªæŒ‡ä»¤å¥½åƒä¸å¥½ä½¿ï¼‰</td>
</tr>
<tr>
<td>x /nuf addr</td>
<td style="text-align:left">æ˜¾ç¤ºæŒ‡å®šå†…å­˜åœ°å€çš„æ•°æ®ï¼Œaddrå¯ä»¥æ˜¯çº¿æ€§çš„å†…å­˜åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯è™šå€ æ ¼å¼æ˜¯åŸºå€ï¼šåç§»æˆ–è€…åŸºå€å¯„å­˜å™¨ï¼šåç§»<br>n æ˜¾ç¤ºçš„æ•°æ®é•¿åº¦<br>u æ•°æ®å•å…ƒå¤§å° b,h,w,gåˆ†åˆ«å¯¹åº”1,2,4,8å­—èŠ‚<br>f æ•°æ®æ˜¾ç¤ºæ ¼å¼ x,d,u,o,t,cåˆ†åˆ«å¯¹åº”åå…­è¿›åˆ¶ã€åè¿›åˆ¶ã€æ— ç¬¦å·åè¿›åˆ¶ã€å…«è¿›åˆ¶ã€äºŒè¿›åˆ¶ã€å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>u [/count] start end</td>
<td style="text-align:left">åæ±‡ç¼–ä¸€æ®µçº¿æ€§å†…å­˜(ä½œç”¨ä¸ä¸Šé¢çš„ä¸€æ ·)<br>(count å‚æ•°æŒ‡æ˜è¦åæ±‡ç¼–çš„æŒ‡ä»¤æ¡æ•° ,ä¾‹å­ï¼šu /5 â€“åæ±‡ç¼–ä»å½“å‰åœ°å€å¼€å§‹çš„5æ¡æŒ‡ä»¤)</td>
</tr>
</tbody>
</table>
<h2 id="infoæŒ‡ä»¤ç»„"><a href="#infoæŒ‡ä»¤ç»„" class="headerlink" title="infoæŒ‡ä»¤ç»„"></a>infoæŒ‡ä»¤ç»„</h2><table>
<thead>
<tr>
<th>æŒ‡ä»¤æ ¼å¼</th>
<th style="text-align:left">åŠŸèƒ½æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>info b</td>
<td style="text-align:left">å±•ç¤ºå½“å‰çš„æ–­ç‚¹çŠ¶æ€ä¿¡æ¯</td>
</tr>
<tr>
<td>info dirty</td>
<td style="text-align:left">å±•ç¤ºè‡ªä»ä¸Šæ¬¡æ˜¾ç¤ºä»¥æ¥ç‰©ç†å†…å­˜ä¸­çš„è„é¡µï¼ˆè¢«å†™çš„é¡µï¼‰</td>
</tr>
<tr>
<td>info program</td>
<td style="text-align:left">å±•ç¤ºç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ï¼ˆæ— æ³•ä½¿ç”¨ï¼ï¼‰</td>
</tr>
<tr>
<td>info r/reg/rigisters</td>
<td style="text-align:left">å±•ç¤ºå¯„å­˜å™¨å†…å®¹</td>
</tr>
<tr>
<td>info cpu</td>
<td style="text-align:left">å±•ç¤ºCPUå¯„å­˜å™¨å†…å®¹</td>
</tr>
<tr>
<td>info fpu</td>
<td style="text-align:left">å±•ç¤ºFPUå¯„å­˜å™¨çš„çŠ¶æ€</td>
</tr>
<tr>
<td>info idt</td>
<td style="text-align:left">å±•ç¤ºä¸­æ–­æè¿°è¡¨</td>
</tr>
<tr>
<td>info ivt</td>
<td style="text-align:left">å±•ç¤ºä¸­æ–­å‘é‡è¡¨(ä¿æŠ¤æ¨¡å¼ä¸‹æ— æ•ˆ)</td>
</tr>
<tr>
<td>info gdt</td>
<td style="text-align:left">å±•ç¤ºå…¨å±€æè¿°è¡¨</td>
</tr>
<tr>
<td>info tss</td>
<td style="text-align:left">å±•ç¤ºå½“å‰çš„ä»»åŠ¡çŠ¶æ€æ®µ</td>
</tr>
<tr>
<td>info cr</td>
<td style="text-align:left">å±•ç¤ºCR0-CR4å¯„å­˜å™¨çŠ¶æ€ ï¼ˆæ— æ³•ä½¿ç”¨ï¼‰</td>
</tr>
<tr>
<td>info flags</td>
<td style="text-align:left">å±•ç¤ºæ ‡å¿—å¯„å­˜å™¨   ï¼ˆæ— æ³•ä½¿ç”¨ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="å¯„å­˜å™¨æŸ¥è¯¢"><a href="#å¯„å­˜å™¨æŸ¥è¯¢" class="headerlink" title="å¯„å­˜å™¨æŸ¥è¯¢"></a>å¯„å­˜å™¨æŸ¥è¯¢</h2><table>
<thead>
<tr>
<th>æŒ‡ä»¤æ ¼å¼</th>
<th style="text-align:left">åŠŸèƒ½æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td style="text-align:left">æŸ¥çœ‹é€šç”¨å¯„å­˜å™¨</td>
</tr>
<tr>
<td>sreg</td>
<td style="text-align:left">æŸ¥çœ‹æ®µå¯„å­˜å™¨ï¼ˆes,cs,gs,ss,fs,dsä»¥åŠidt,gdt,ldt,trï¼‰</td>
</tr>
<tr>
<td>creg</td>
<td style="text-align:left">æŸ¥çœ‹æ§åˆ¶å¯„å­˜å™¨ï¼ˆcr0ï¼Œcr1ï¼Œcr2ï¼Œcr3ï¼‰</td>
</tr>
<tr>
<td>dreg</td>
<td style="text-align:left">æŸ¥çœ‹è°ƒè¯•å¯„å­˜å™¨ï¼ˆdr0-dr7ï¼‰</td>
</tr>
</tbody>
</table>
<p>è¿™é‡Œå†æ’ä¸€å¥ï¼Œæ ‡å¿—å¯„å­˜å™¨çš„æŸ¥çœ‹æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">eflags 0x00000002: id vip vif ac vm rf nt IOPL=0 of df if tf sf zf af pf cf    ï¼ˆå‡æœªç½®ä½ï¼‰</div><div class="line"></div><div class="line">eflags 0x00000046: id vip vif ac vm rf nt IOPL=0 of df if tf sf ZF af PF cf ï¼ˆZF,PFç½®ä½ï¼‰</div></pre></td></tr></table></figure></p>
<p>0x00000002æ˜¯æ ‡å¿—å¯„å­˜å™¨çš„å®é™…æ•°å€¼ï¼Œåé¢çš„zfï¼Œsfç­‰ä¸ºæ ‡å¿—ä½ï¼Œå°å†™æ—¶æ ‡å¿—ä½æœªç½®ä½ï¼Œå¤§å†™ä¸ºå·²ç½®ä½ã€‚</p>
<h1 id="åœ¨linux0-12ç³»ç»Ÿä¸Šç¼–è¯‘0-12å†…æ ¸ï¼š"><a href="#åœ¨linux0-12ç³»ç»Ÿä¸Šç¼–è¯‘0-12å†…æ ¸ï¼š" class="headerlink" title="åœ¨linux0.12ç³»ç»Ÿä¸Šç¼–è¯‘0.12å†…æ ¸ï¼š"></a>åœ¨linux0.12ç³»ç»Ÿä¸Šç¼–è¯‘0.12å†…æ ¸ï¼š</h1><ul>
<li><p>ä»å‰æ–‡ä¸‹è½½çš„æ ¹æ–‡ä»¶ç³»ç»Ÿrootimage-0.12ä¸Šå·²ç»åŒ…å«äº†0.12å†…æ ¸çš„æºç ï¼Œä½äº/usr/src/linuxã€‚</p>
</li>
<li><p>ä½¿ç”¨makeå‘½ä»¤ç¼–è¯‘æºç ï¼Œç”Ÿæˆå¼•å¯¼åŒºå¯åŠ¨é•œåƒæ–‡ä»¶Imageã€‚</p>
</li>
<li><p>é€šè¿‡å‘½ä»¤dd bs=8192 if=Image of=/dev/fd0 å°†ç”Ÿæˆçš„é•œåƒè¾“å‡ºåˆ°è™šæ‹Ÿè½¯ç›˜æ–‡ä»¶bootimage-0.12-hdä¸Šï¼ˆè®°å¾—å…ˆå¤‡ä»½ä¸€ä¸ªå•Šï¼ï¼‰ï¼Œå†æ¬¡å¯åŠ¨bochsï¼Œå³å¯ç”±æ–°çš„é•œåƒå¼•å¯¼å¯åŠ¨äº†ã€‚</p>
</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;bochsçš„ä½¿ç”¨å’Œè°ƒè¯• linuxå†…æ ¸&lt;br&gt;
    
    </summary>
    
      <category term="Linuxå†…æ ¸" scheme="http://blog.snowwalf.com/categories/Linux%E5%86%85%E6%A0%B8/"/>
    
    
      <category term="linux" scheme="http://blog.snowwalf.com/tags/linux/"/>
    
      <category term="bochs" scheme="http://blog.snowwalf.com/tags/bochs/"/>
    
      <category term="è°ƒè¯•" scheme="http://blog.snowwalf.com/tags/%E8%B0%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>A20åœ°å€çº¿çš„ä¸€ç‚¹ç†è§£</title>
    <link href="http://blog.snowwalf.com/2011/05/27/a20-bus/"/>
    <id>http://blog.snowwalf.com/2011/05/27/a20-bus/</id>
    <published>2011-05-27T11:30:00.000Z</published>
    <updated>2016-12-14T16:17:44.000Z</updated>
    
    <content type="html"><![CDATA[<p><em>A20åœ°å€çº¿ Linuxå†…æ ¸å®ç°åŠç³»ç»Ÿå¯åŠ¨å¼•å¯¼</em><br><a id="more"></a></p>
<h2 id="A20åœ°å€çº¿"><a href="#A20åœ°å€çº¿" class="headerlink" title="A20åœ°å€çº¿"></a>A20åœ°å€çº¿</h2><p>å…ˆæ¥çœ‹çœ‹A20åœ°å€çº¿çš„ç”±æ¥å’Œå†å²é—ç•™é—®é¢˜ï¼ˆçº¯æ¬è¿ï¼‰ï¼š</p>
<blockquote>
<p>   1981å¹´8æœˆï¼ŒIBMå…¬å¸æœ€åˆæ¨å‡ºçš„ä¸ªäººè®¡ç®—æœºIBM PCä½¿ç”¨çš„CPUæ˜¯Intel 8088ã€‚åœ¨è¯¥å¾®æœºä¸­åœ°å€çº¿åªæœ‰20æ ¹(A0 â€“ A19)ã€‚åœ¨å½“æ—¶å†…å­˜RAMåªæœ‰å‡ ç™¾KBæˆ–ä¸åˆ°1MBæ—¶ï¼Œ20æ ¹åœ°å€çº¿å·²è¶³å¤Ÿç”¨æ¥å¯»å€è¿™äº›å†…å­˜ã€‚å…¶æ‰€èƒ½å¯»å€çš„æœ€é«˜åœ°å€æ˜¯0xffff:0xffffï¼Œä¹Ÿå³0x10ffefã€‚å¯¹äºè¶…å‡º0x100000(1MB)çš„å¯»å€åœ°å€å°†é»˜è®¤åœ°ç¯ç»•åˆ°0x0ffefã€‚å½“IBMå…¬å¸äº1985å¹´å¼•å…¥ATæœºæ—¶ï¼Œä½¿ç”¨çš„æ˜¯Intel 80286 CPUï¼Œå…·æœ‰24æ ¹åœ°å€çº¿ï¼Œæœ€é«˜å¯å¯»å€16MBï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªä¸8088å®Œå…¨å…¼å®¹çš„å®æ¨¡å¼è¿è¡Œæ–¹å¼ã€‚ç„¶è€Œï¼Œåœ¨å¯»å€å€¼è¶…è¿‡1MBæ—¶å®ƒå´ä¸èƒ½è±¡8088é‚£æ ·å®ç°åœ°å€å¯»å€çš„ç¯ç»•ã€‚ä½†æ˜¯å½“æ—¶å·²ç»æœ‰ä¸€äº›ç¨‹åºæ˜¯åˆ©ç”¨è¿™ç§åœ°å€ç¯ç»•æœºåˆ¶è¿›è¡Œå·¥ä½œçš„ã€‚ä¸ºäº†å®ç°å®Œå…¨çš„å…¼å®¹æ€§ï¼ŒIBMå…¬å¸å‘æ˜äº†ä½¿ç”¨ä¸€ä¸ªå¼€å…³æ¥å¼€å¯æˆ–ç¦æ­¢0x100000åœ°å€æ¯”ç‰¹ä½ã€‚ç”±äºåœ¨å½“æ—¶çš„8042é”®ç›˜æ§åˆ¶å™¨ä¸Šæ°å¥½æœ‰ç©ºé—²çš„ç«¯å£å¼•è„šï¼ˆè¾“å‡ºç«¯å£P2ï¼Œå¼•è„šP21ï¼‰ï¼Œäºæ˜¯ä¾¿ä½¿ç”¨äº†è¯¥å¼•è„šæ¥ä½œä¸ºä¸é—¨æ§åˆ¶è¿™ä¸ªåœ°å€æ¯”ç‰¹ä½ã€‚è¯¥ä¿¡å·å³è¢«ç§°ä¸ºA20ã€‚å¦‚æœA20ä¸ºé›¶ï¼Œåˆ™æ¯”ç‰¹20åŠä»¥ä¸Šåœ°å€éƒ½è¢«æ¸…é™¤ã€‚ä»è€Œå®ç°äº†å…¼å®¹æ€§ã€‚</p>
</blockquote>
<p>ç”±äºåœ¨æœºå™¨å¯åŠ¨æ—¶ï¼Œé»˜è®¤æ¡ä»¶ä¸‹ï¼ŒA20åœ°å€çº¿æ˜¯ç¦æ­¢çš„ï¼Œæ‰€ä»¥æ“ä½œç³»ç»Ÿå¿…é¡»ä½¿ç”¨é€‚å½“çš„æ–¹æ³•æ¥å¼€å¯å®ƒã€‚ä½†æ˜¯ç”±äºå„ç§å…¼å®¹æœºæ‰€ä½¿ç”¨çš„èŠ¯ç‰‡é›†ä¸åŒï¼Œè¦åšåˆ°è¿™ä¸€ç‚¹å´æ˜¯éå¸¸çš„éº»çƒ¦ã€‚å› æ­¤é€šå¸¸è¦åœ¨å‡ ç§æ§åˆ¶æ–¹æ³•ä¸­é€‰æ‹©ã€‚</p>
<h2 id="A20åœ°å€çº¿çš„æ§åˆ¶"><a href="#A20åœ°å€çº¿çš„æ§åˆ¶" class="headerlink" title="A20åœ°å€çº¿çš„æ§åˆ¶"></a>A20åœ°å€çº¿çš„æ§åˆ¶</h2><p>å¯¹A20ä¿¡å·çº¿è¿›è¡Œæ§åˆ¶çš„å¸¸ç”¨æ–¹æ³•æ˜¯é€šè¿‡è®¾ç½®é”®ç›˜æ§åˆ¶å™¨çš„ç«¯å£å€¼ã€‚ä¸‹é¢å¼•ç”¨ä¸€æ®µlinux0.11çš„æºç ï¼ˆsetup.sï¼‰:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">	call 	empty_8042</div><div class="line"> </div><div class="line">	mov	al,#0xd1</div><div class="line">	out	#0x64,al</div><div class="line">	call	empty_8042</div><div class="line">	mov	al,#0xdf</div><div class="line">	out	#0x60,al</div><div class="line">	call	empty_8042</div><div class="line"> </div><div class="line">...</div><div class="line"> </div><div class="line">empty_8042:</div><div class="line">	.word 0x00eb,0x00eb</div><div class="line">	in 	al,#0x64</div><div class="line">	test	al,#2</div><div class="line">	jnz	empty_8042</div><div class="line">	ret</div></pre></td></tr></table></figure></p>
<p>è´´ä¸€ä¸‹å•Šhead.sä¸­çš„ä»£ç (è¿™é‡Œè½¬æˆIntelæ±‡ç¼–æ ¼å¼ï¼Œæºç æ˜¯AT&amp;Aæ±‡ç¼–ï¼Œçœ‹ç€è›‹ç–¼ã€‚ã€‚)ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">	xor eax,eax</div><div class="line">l:</div><div class="line">	inc eax</div><div class="line">	mov [0x000000],eax;</div><div class="line">	cmp [0x100000],eax;</div><div class="line">	je lb</div></pre></td></tr></table></figure></p>
<p>å‘0x000000å­—èŠ‚å¤„æ•°æ®æ”¹ä¸º1ï¼ŒæŸ¥çœ‹0x100000å¤„æ•°æ®æ˜¯å¦åŒæ—¶å˜æˆäº†1ï¼Œè‹¥æ˜¯åˆ™A20åœ°å€çº¿æ²¡ç”¨å¼€å¯ï¼›å¦åˆ™å¼€å¯æˆåŠŸã€‚</p>
<h2 id="Intel-8042èŠ¯ç‰‡"><a href="#Intel-8042èŠ¯ç‰‡" class="headerlink" title="Intel 8042èŠ¯ç‰‡"></a>Intel 8042èŠ¯ç‰‡</h2><p>è§£é‡Šä¸€ä¸‹Intel 8042èŠ¯ç‰‡ï¼ˆåˆæ˜¯æ¬è¿ã€‚ã€‚ã€‚ï¼‰ï¼š</p>
<blockquote>
<p>   ntel8024æ˜¯intelå…¬å¸çš„ä¸€æ¬¾é”®ç›˜æ§åˆ¶å™¨èŠ¯ç‰‡,å®ƒä¸ºx86ç³»ç»Ÿä¸­çš„æ ‡å‡†é…ç½®.è™½ç„¶åä¸ºé”®ç›˜æ§åˆ¶å™¨,ä½†æ˜¯é¼ æ ‡ä¹Ÿæ˜¯ç”±å…¶æ§åˆ¶çš„.<br>    é”®ç›˜é€šå¸¸ä½¿ç”¨IRQ1.é¼ æ ‡é€šå¸¸ä½¿ç”¨IRQ12.IRQ1å’ŒIRQ12éƒ½æ˜¯è¿æ¥åœ¨é”®ç›˜æ§åˆ¶å™¨ä¸Šçš„.å¯¹åº”intel8042çš„ä¸¤ä¸ªç«¯å£.</p>
</blockquote>
<pre><code>é…ç»™é”®ç›˜æ§åˆ¶å™¨çš„I/Oç«¯å£æœ‰å››ä¸ª,åˆ†åˆ«æ˜¯0x60~0x64.åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸­,åªä¼šä½¿ç”¨åˆ°0x60å’Œ0x64.å…¶ä½™0x61~0x64çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹XT.å¯ä»¥å°†0x64çœ‹åšæ˜¯çŠ¶æ€å¯„å­˜å™¨.0x60çœ‹æˆæ˜¯æ•°æ®å¯„å­˜å™¨.æœ‰æ—¶åœ¨ç»™é”®ç›˜æ§åˆ¶å™¨ä¸‹æŒ‡ä»¤çš„æ—¶å€™,è¿™ä¸¤ä¸ªç«¯å£éƒ½è¦ç”¨åˆ°.ä¸¤è€…é…åˆæ¥è¾¾åˆ°ä¸‹æŒ‡ä»¤ä¸å‚æ•°çš„ç›®çš„.
</code></pre><h2 id="å‘i8042å‘é€å‘½ä»¤"><a href="#å‘i8042å‘é€å‘½ä»¤" class="headerlink" title="å‘i8042å‘é€å‘½ä»¤:"></a>å‘i8042å‘é€å‘½ä»¤:</h2><ol>
<li>æˆ‘ä»¬éœ€è¦å…ˆæŠŠå‘½ä»¤å‘é€åˆ°0x64ç«¯å£ï¼Œ</li>
<li>ç„¶åç´§æ¥ç€æŠŠè¿™ä¸ªå‘½ä»¤çš„å‚æ•°å‘é€åˆ°0x60ç«¯å£ï¼Œ</li>
<li>ç„¶åæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»0x60ç«¯å£ï¼Œè·å¾—i8042è¿”å›ç»™æˆ‘ä»¬çš„æ•°æ®ã€‚</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;em&gt;A20åœ°å€çº¿ Linuxå†…æ ¸å®ç°åŠç³»ç»Ÿå¯åŠ¨å¼•å¯¼&lt;/em&gt;&lt;br&gt;
    
    </summary>
    
      <category term="Linuxå†…æ ¸" scheme="http://blog.snowwalf.com/categories/Linux%E5%86%85%E6%A0%B8/"/>
    
    
      <category term="linux" scheme="http://blog.snowwalf.com/tags/linux/"/>
    
  </entry>
  
</feed>
